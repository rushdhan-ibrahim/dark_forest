/* ==========================================
   STARFIELD
   ========================================== */
.starfield {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: -10;
}

.star-layer {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
}

.ascii-star {
    position: absolute;
    font-family: 'JetBrains Mono', monospace;
    transition: all 0.4s ease-out;
}

.ascii-star.bright {
    text-shadow: 0 0 8px currentColor, 0 0 15px currentColor;
}

.shooting-star-head {
    position: fixed;
    color: var(--starlight);
    text-shadow: 0 0 6px var(--starlight), 0 0 12px var(--blue-giant);
    font-family: 'JetBrains Mono', monospace;
    pointer-events: none;
    z-index: -10;
}

.shooting-star-trail {
    position: fixed;
    background: linear-gradient(90deg,
        transparent 0%,
        rgba(170, 204, 255, 0.1) 20%,
        rgba(170, 204, 255, 0.4) 60%,
        rgba(232, 230, 227, 0.8) 100%
    );
    height: 1px;
    transform-origin: right center;
    pointer-events: none;
    z-index: -10;
}

/* ==========================================
   NEBULAE
   ========================================== */
.nebula-layer {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: -11;
    opacity: 0;
    animation: nebulaFadeIn 4s ease-out forwards;
}

@keyframes nebulaFadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.nebula {
    position: absolute;
    border-radius: 50%;
    filter: blur(60px);
    mix-blend-mode: screen;
    pointer-events: none;
}

/* Deep purple nebula - distant, mysterious */
.nebula--purple {
    background: radial-gradient(
        ellipse at center,
        rgba(90, 50, 120, 0.4) 0%,
        rgba(70, 40, 100, 0.25) 30%,
        rgba(50, 30, 80, 0.1) 60%,
        transparent 80%
    );
    animation: nebulaDrift1 120s ease-in-out infinite;
}

/* Cold blue nebula - stellar nursery feel */
.nebula--blue {
    background: radial-gradient(
        ellipse at center,
        rgba(80, 120, 180, 0.35) 0%,
        rgba(60, 100, 160, 0.2) 35%,
        rgba(40, 80, 140, 0.08) 65%,
        transparent 85%
    );
    animation: nebulaDrift2 90s ease-in-out infinite;
}

/* Warm dust cloud - ancient, primordial */
.nebula--dust {
    background: radial-gradient(
        ellipse at center,
        rgba(140, 100, 80, 0.3) 0%,
        rgba(120, 80, 60, 0.15) 40%,
        rgba(100, 60, 40, 0.05) 70%,
        transparent 90%
    );
    animation: nebulaDrift3 150s ease-in-out infinite;
}

/* Teal emission nebula - rare, ethereal */
.nebula--teal {
    background: radial-gradient(
        ellipse at center,
        rgba(60, 140, 140, 0.25) 0%,
        rgba(50, 120, 120, 0.12) 45%,
        rgba(40, 100, 100, 0.04) 75%,
        transparent 95%
    );
    animation: nebulaDrift4 180s ease-in-out infinite;
}

/* Drift animations - each nebula moves on its own path */
@keyframes nebulaDrift1 {
    0%, 100% {
        transform: translate(0, 0) scale(1);
    }
    25% {
        transform: translate(5%, -3%) scale(1.05);
    }
    50% {
        transform: translate(-3%, 5%) scale(0.95);
    }
    75% {
        transform: translate(-5%, -2%) scale(1.02);
    }
}

@keyframes nebulaDrift2 {
    0%, 100% {
        transform: translate(0, 0) scale(1) rotate(0deg);
    }
    33% {
        transform: translate(-4%, 4%) scale(1.08) rotate(2deg);
    }
    66% {
        transform: translate(6%, -2%) scale(0.92) rotate(-1deg);
    }
}

@keyframes nebulaDrift3 {
    0%, 100% {
        transform: translate(0, 0) scale(1);
    }
    20% {
        transform: translate(3%, 4%) scale(1.03);
    }
    40% {
        transform: translate(-2%, -3%) scale(0.97);
    }
    60% {
        transform: translate(-4%, 2%) scale(1.06);
    }
    80% {
        transform: translate(2%, -4%) scale(0.94);
    }
}

@keyframes nebulaDrift4 {
    0%, 100% {
        transform: translate(0, 0) scale(1) rotate(0deg);
    }
    50% {
        transform: translate(-6%, 3%) scale(1.1) rotate(-3deg);
    }
}

/* Nebula breathing - subtle opacity pulse */
.nebula--breathe {
    animation-name: nebulaDrift1, nebulaBreathe;
    animation-duration: 120s, 20s;
    animation-timing-function: ease-in-out, ease-in-out;
    animation-iteration-count: infinite, infinite;
}

@keyframes nebulaBreathe {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
}

/* Mobile: reduce nebula intensity for performance */
@media (max-width: 768px) {
    .nebula {
        filter: blur(40px);
    }

    .nebula-layer {
        opacity: 0.6;
    }
}

@media (max-width: 480px) {
    .nebula {
        filter: blur(30px);
    }

    .nebula-layer {
        opacity: 0.4;
    }

    /* Hide some nebulae on very small screens */
    .nebula:nth-child(n+4) {
        display: none;
    }
}

/* Reduced motion: disable animations */
@media (prefers-reduced-motion: reduce) {
    .nebula {
        animation: none !important;
    }

    .nebula-layer {
        animation: none !important;
        opacity: 0.5;
    }
}

/* ==========================================
   HERO FOREST
   ========================================== */
#hero-forest {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 280px;
    overflow: hidden;
    opacity: 0;
    animation: fadeUp 2s ease 0.8s forwards;
    background: linear-gradient(to bottom,
        transparent 0%,
        rgba(8, 8, 12, 0.4) 30%,
        rgba(8, 8, 12, 0.8) 70%,
        rgba(8, 8, 12, 0.95) 100%
    );
}

.forest-layer {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    white-space: pre;
    font-family: 'JetBrains Mono', monospace;
    font-size: 14px;
    line-height: 1.2;
    color: var(--text-tertiary);
    opacity: 0.35;
}

.fog-layer {
    position: absolute;
    width: 100%;
    font-family: 'JetBrains Mono', monospace;
    color: var(--text-tertiary);
}

.forest-eye {
    position: absolute;
    font-family: 'JetBrains Mono', monospace;
    font-size: 20px;
    transition: transform 0.12s ease-out, text-shadow 0.3s ease, opacity 0.5s ease;
    cursor: pointer;
    z-index: 10;
    opacity: 0;
    text-shadow:
        0 0 10px currentColor,
        0 0 20px currentColor,
        0 0 40px rgba(255, 100, 100, 0.3);
}

.forest-eye.visible {
    opacity: 1;
}

.forest-eye::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 60px;
    height: 60px;
    transform: translate(-50%, -50%);
    border-radius: 50%;
    background: radial-gradient(circle, currentColor 0%, transparent 70%);
    opacity: 0.15;
    animation: eyePulse 3s ease-in-out infinite;
    pointer-events: none;
}

@keyframes eyePulse {
    0%, 100% { opacity: 0.1; transform: translate(-50%, -50%) scale(1); }
    50% { opacity: 0.25; transform: translate(-50%, -50%) scale(1.2); }
}

.forest-eye.tracking {
    text-shadow:
        0 0 15px currentColor,
        0 0 30px currentColor,
        0 0 60px currentColor,
        0 0 80px rgba(255, 100, 100, 0.4);
}

.forest-eye.tracking::before {
    opacity: 0.3;
    animation: eyePulseActive 1.5s ease-in-out infinite;
}

@keyframes eyePulseActive {
    0%, 100% { opacity: 0.2; transform: translate(-50%, -50%) scale(1); }
    50% { opacity: 0.4; transform: translate(-50%, -50%) scale(1.3); }
}

.forest-eye.blinking {
    animation: blink 0.15s ease-in-out;
}

/* Eye Personality Styles */

/* Curious - eager, bright, slightly pulsing */
.forest-eye.eye-curious {
    text-shadow:
        0 0 8px currentColor,
        0 0 16px currentColor,
        0 0 32px rgba(200, 220, 100, 0.4);
}

.forest-eye.eye-curious.tracking {
    text-shadow:
        0 0 12px currentColor,
        0 0 24px currentColor,
        0 0 48px currentColor,
        0 0 64px rgba(200, 220, 100, 0.5);
    animation: curiousPulse 0.8s ease-in-out infinite;
}

@keyframes curiousPulse {
    0%, 100% { filter: brightness(1); }
    50% { filter: brightness(1.3); }
}

/* Hostile - aggressive, intense glow */
.forest-eye.eye-hostile {
    text-shadow:
        0 0 10px currentColor,
        0 0 20px currentColor,
        0 0 40px rgba(255, 50, 50, 0.5),
        0 0 60px rgba(255, 0, 0, 0.3);
}

.forest-eye.eye-hostile.tracking {
    text-shadow:
        0 0 15px currentColor,
        0 0 30px currentColor,
        0 0 60px rgba(255, 50, 50, 0.7),
        0 0 100px rgba(255, 0, 0, 0.4);
    filter: brightness(1.2);
}

/* Indifferent - muted, distant */
.forest-eye.eye-indifferent {
    opacity: 0.7;
    text-shadow:
        0 0 6px currentColor,
        0 0 12px rgba(100, 100, 150, 0.3);
}

.forest-eye.eye-indifferent.tracking {
    opacity: 0.85;
    text-shadow:
        0 0 8px currentColor,
        0 0 16px rgba(100, 100, 150, 0.4);
}

/* Ancient - deep, slow-breathing glow */
.forest-eye.eye-ancient {
    text-shadow:
        0 0 12px currentColor,
        0 0 24px rgba(200, 150, 80, 0.5),
        0 0 48px rgba(180, 120, 60, 0.3);
    animation: ancientBreathe 6s ease-in-out infinite;
}

.forest-eye.eye-ancient.tracking {
    text-shadow:
        0 0 16px currentColor,
        0 0 32px rgba(200, 150, 80, 0.6),
        0 0 64px rgba(180, 120, 60, 0.4),
        0 0 96px rgba(150, 100, 50, 0.2);
}

@keyframes ancientBreathe {
    0%, 100% {
        opacity: 0.9;
        filter: brightness(0.9);
    }
    50% {
        opacity: 1;
        filter: brightness(1.1);
    }
}

@keyframes blink {
    0%, 100% { transform: scaleY(1); }
    50% { transform: scaleY(0.1); }
}

.forest-eye:hover {
    text-shadow:
        0 0 20px currentColor,
        0 0 40px currentColor,
        0 0 80px currentColor;
}

/* Touch interaction states for mobile */
@media (pointer: coarse) {
    #hero-forest.touch-active .forest-eye,
    #hero-forest.gyro-active .forest-eye {
        /* Faster transitions during active interaction */
        transition: transform 0.08s ease-out, text-shadow 0.15s ease;
    }

    #hero-forest.touch-active .forest-eye.tracking,
    #hero-forest.gyro-active .forest-eye.tracking {
        /* Enhanced glow during interaction */
        text-shadow:
            0 0 20px currentColor,
            0 0 40px currentColor,
            0 0 70px currentColor;
    }

    /* Smoother transitions for gyro mode - longer duration for fluid feel */
    #hero-forest.gyro-active .forest-eye {
        transition: transform 0.25s ease-out, text-shadow 0.3s ease;
    }

    /* Larger tap target for touch devices */
    .forest-eye::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 48px;
        height: 48px;
        transform: translate(-50%, -50%);
        pointer-events: none;
    }

    /* Hint to interact with the forest on mobile */
    #hero-forest::before {
        content: 'drag finger to control the eyes';
        position: absolute;
        bottom: 55px;
        left: 50%;
        transform: translateX(-50%);
        font-family: 'JetBrains Mono', monospace;
        font-size: 12px;
        color: rgba(200, 220, 240, 0.85);
        letter-spacing: 0.05em;
        text-transform: lowercase;
        opacity: 1;
        transition: opacity 0.8s ease;
        pointer-events: none;
        text-align: center;
        white-space: nowrap;
        z-index: 20;
        background: rgba(10, 12, 20, 0.7);
        padding: 6px 14px;
        border-radius: 4px;
        border: 1px solid rgba(150, 170, 200, 0.2);
    }

    #hero-forest.touch-active::before {
        opacity: 0;
    }

    /* Tilt mode toggle button - matches project aesthetic */
    .tilt-mode-toggle {
        position: absolute;
        bottom: 10px;
        right: 10px;
        padding: 6px 12px;
        font-family: 'JetBrains Mono', monospace;
        font-size: 10px;
        font-weight: 500;
        letter-spacing: 0.05em;
        color: var(--text-primary);
        background: rgba(12, 12, 18, 0.9);
        border: 1px solid var(--cold-blue);
        border-radius: 3px;
        cursor: pointer;
        z-index: 25;
        transition: all 0.2s ease;
        -webkit-tap-highlight-color: transparent;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.4);
    }

    .tilt-mode-toggle:hover,
    .tilt-mode-toggle:focus {
        background: var(--cold-blue);
        border-color: var(--bright-blue);
        color: var(--starlight);
    }

    .tilt-mode-toggle:active {
        transform: scale(0.98);
    }

    .tilt-mode-toggle.active {
        color: var(--starlight);
        border-color: var(--hope-teal);
        background: rgba(90, 138, 138, 0.25);
        box-shadow: 0 0 15px rgba(90, 138, 138, 0.2);
    }

    /* Update hint when gyro is active */
    #hero-forest.gyro-active::before {
        content: 'tilt phone to move eyes';
        opacity: 1;
    }

    #hero-forest.gyro-active.touch-active::before {
        opacity: 0;
    }
}

/* Sustained observation states */
.forest-eye.being-observed {
    animation: observationPulse 1.5s ease-in-out infinite;
}

@keyframes observationPulse {
    0%, 100% {
        filter: brightness(1);
        text-shadow:
            0 0 15px currentColor,
            0 0 30px currentColor;
    }
    50% {
        filter: brightness(1.4);
        text-shadow:
            0 0 20px currentColor,
            0 0 40px currentColor,
            0 0 60px rgba(255, 255, 255, 0.3);
    }
}

.forest-eye.has-whispered {
    opacity: 0.6;
    filter: brightness(0.8);
}

.forest-eye.has-whispered::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 80px;
    height: 80px;
    transform: translate(-50%, -50%);
    border-radius: 50%;
    background: radial-gradient(circle, transparent 30%, rgba(180, 200, 220, 0.05) 70%);
    pointer-events: none;
    animation: whisperRipple 3s ease-out forwards;
}

@keyframes whisperRipple {
    0% {
        width: 20px;
        height: 20px;
        opacity: 0.5;
    }
    100% {
        width: 120px;
        height: 120px;
        opacity: 0;
    }
}

/* Whisper fragment text */
.whisper-fragment {
    max-width: 300px;
    text-align: center;
    line-height: 1.4;
    z-index: 100;
}

@media (max-width: 768px) {
    .whisper-fragment {
        font-size: 10px;
        max-width: 200px;
    }
}

/* Paired eye styles */
.forest-eye.eye-paired {
    z-index: 12;
}

.forest-eye.eye-paired::before {
    animation: pairedPulse 4s ease-in-out infinite;
}

@keyframes pairedPulse {
    0%, 100% {
        opacity: 0.15;
        transform: translate(-50%, -50%) scale(1);
    }
    50% {
        opacity: 0.25;
        transform: translate(-50%, -50%) scale(1.1);
    }
}

/* Connection line between paired eyes */
.eye-connection {
    z-index: 11;
    transition: opacity 0.5s ease, filter 0.3s ease;
}

.eye-connection.broken {
    opacity: 0.05 !important;
    filter: blur(2px);
}

/* Interrupted state - when cursor passes between paired eyes */
.forest-eye.interrupted {
    animation: interruptedFlash 0.3s ease-out;
}

@keyframes interruptedFlash {
    0% {
        filter: brightness(2);
        text-shadow:
            0 0 20px currentColor,
            0 0 40px currentColor,
            0 0 60px rgba(255, 255, 255, 0.5);
    }
    100% {
        filter: brightness(1.2);
        text-shadow:
            0 0 15px currentColor,
            0 0 30px currentColor;
    }
}

.forest-eye.eye-paired.interrupted {
    text-shadow:
        0 0 15px currentColor,
        0 0 30px currentColor,
        0 0 50px rgba(255, 200, 200, 0.3);
}

/* ==========================================
   ASCII INTERACTIVE CONTAINER
   ========================================== */
.ascii-interactive {
    background: var(--void);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 6px;
    margin: var(--space-2xl) 0;
    overflow: hidden;
    font-family: 'JetBrains Mono', monospace;
    box-shadow:
        0 0 30px rgba(10, 10, 15, 0.98),
        0 0 60px rgba(10, 10, 15, 0.9),
        0 0 100px rgba(74, 85, 104, 0.1);
}

.ascii-interactive .ascii-header {
    padding: var(--space-md) var(--space-lg);
    background: var(--deep-space);
    border-bottom: 1px solid rgba(255,255,255,0.06);
    font-size: var(--text-xs);
    font-weight: 500;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--text-secondary);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: var(--space-sm);
}

.ascii-interactive .ascii-content {
    position: relative;
    font-size: 14px;
    line-height: 1.2;
}

/* ==========================================
   GLASS FOREST
   ========================================== */
#glass-forest-container {
    height: 350px;
    cursor: crosshair;
    position: relative;
}

.glass-node {
    position: absolute;
    font-size: 18px;
    cursor: pointer;
    transition: all 0.3s ease;
    z-index: 10;
}

.glass-node:hover {
    transform: scale(1.3);
    filter: brightness(1.3);
}

.glass-node.observing {
    animation: observing-pulse 0.3s ease infinite alternate;
}

@keyframes observing-pulse {
    from { text-shadow: 0 0 5px currentColor; }
    to { text-shadow: 0 0 20px currentColor, 0 0 30px currentColor; }
}

.glass-node.firing {
    animation: muzzle-flash 0.4s ease;
}

@keyframes muzzle-flash {
    0% { text-shadow: none; transform: scale(1); }
    20% { text-shadow: 0 0 40px #fff, 0 0 80px var(--warning-amber); transform: scale(1.5); }
    100% { text-shadow: 0 0 10px currentColor; transform: scale(1); }
}

.glass-node.dead {
    color: var(--text-tertiary) !important;
    opacity: 0.3;
    transform: scale(0.8);
    cursor: default;
}

.sight-line {
    position: absolute;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent);
    transform-origin: left center;
    opacity: 0.5;
    pointer-events: none;
    transition: all 0.3s ease;
}

.sight-line.alert {
    background: linear-gradient(90deg, transparent, var(--danger-red), transparent);
    opacity: 1;
    height: 2px;
}

.sight-line.to-shooter {
    background: linear-gradient(90deg, transparent, var(--warning-amber), transparent);
    opacity: 1;
    height: 2px;
}

#glass-phase {
    position: absolute;
    top: 15px;
    left: 50%;
    transform: translateX(-50%);
    font-size: var(--text-xs);
    font-weight: 500;
    padding: var(--space-sm) var(--space-lg);
    background: rgba(0,0,0,0.6);
    border: 1px solid rgba(255,255,255,0.15);
    letter-spacing: 0.1em;
    border-radius: 3px;
}

#glass-message {
    position: absolute;
    bottom: 15px;
    left: 50%;
    transform: translateX(-50%);
    font-size: var(--text-xs);
    color: var(--text-secondary);
    text-align: center;
}

/* Game mode toggle */
.game-mode-toggle {
    display: flex;
    gap: var(--space-xs);
    margin-left: auto;
}

.game-mode-btn {
    font-family: 'JetBrains Mono', monospace;
    font-size: var(--text-xs);
    padding: var(--space-xs) var(--space-sm);
    background: transparent;
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.2s ease;
    letter-spacing: 0.05em;
}

.game-mode-btn:hover {
    border-color: rgba(255, 255, 255, 0.4);
    color: var(--text-primary);
}

.game-mode-btn.active {
    background: rgba(255, 255, 255, 0.1);
    border-color: rgba(100, 180, 120, 0.5);
    color: var(--text-primary);
}

/* Trust bars on nodes */
.trust-bar {
    position: absolute;
    bottom: -8px;
    left: 50%;
    transform: translateX(-50%);
    width: 30px;
    height: 3px;
    background: rgba(0, 0, 0, 0.4);
    border-radius: 2px;
    overflow: hidden;
    opacity: 0;
    transition: opacity 0.3s ease;
}

/* Only show trust bars in iterated mode */
[data-mode="iterated"] .trust-bar,
.glass-node .trust-bar {
    opacity: 0;
}

.game-mode-toggle + #glass-forest-container .trust-bar,
#glass-forest-container[data-mode="iterated"] .trust-bar {
    opacity: 1;
}

.trust-fill {
    height: 100%;
    background: rgba(180, 180, 80, 0.6);
    transition: width 0.5s ease, background 0.5s ease;
    border-radius: 2px;
}

/* High trust state */
.glass-node.high-trust {
    text-shadow: 0 0 10px rgba(100, 200, 120, 0.5);
}

.glass-node.high-trust::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(100, 200, 120, 0.15) 0%, transparent 70%);
    pointer-events: none;
    animation: trust-glow 2s ease-in-out infinite;
}

@keyframes trust-glow {
    0%, 100% { opacity: 0.5; transform: translate(-50%, -50%) scale(1); }
    50% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
}

/* Defector state */
.glass-node.defector {
    animation: defector-pulse 0.3s ease infinite alternate;
}

@keyframes defector-pulse {
    from {
        text-shadow: 0 0 10px rgba(200, 80, 80, 0.8);
        filter: brightness(1.2);
    }
    to {
        text-shadow: 0 0 30px rgba(200, 80, 80, 1), 0 0 50px rgba(200, 50, 50, 0.6);
        filter: brightness(1.5);
    }
}

/* Isolated state (after forgiveness) */
.glass-node.isolated {
    opacity: 0.6;
    filter: saturate(0.5);
}

.glass-node.isolated .trust-bar {
    opacity: 0.3;
}

/* Responsive adjustments for glass forest */
@media (max-width: 480px) {
    .game-mode-toggle {
        margin-left: 0;
        margin-top: var(--space-sm);
    }

    .game-mode-btn {
        padding: var(--space-xs) var(--space-sm);
        font-size: 10px;
    }

    .trust-bar {
        width: 24px;
        bottom: -6px;
    }
}

/* ==========================================
   THERMOMETER
   ========================================== */
#thermo-container {
    height: 220px;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
}

.heat-ring {
    position: absolute;
    border-radius: 50%;
    border: 1px solid;
    pointer-events: none;
}

#thermo-core {
    position: relative;
    z-index: 2;
    text-align: center;
    font-size: 11px;
    color: var(--warning-amber);
}

#thermo-label {
    position: absolute;
    bottom: 15px;
    left: 50%;
    transform: translateX(-50%);
    font-size: var(--text-xs);
    color: var(--text-secondary);
    font-style: italic;
    text-align: center;
}

/* ==========================================
   SIGNAL PROPAGATION
   ========================================== */
#signal-container {
    height: 180px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 var(--space-xl);
    position: relative;
}

.signal-source, .signal-dest {
    font-size: 10px;
    text-align: center;
    z-index: 2;
}

.signal-wave {
    position: absolute;
    font-size: 16px;
    letter-spacing: 2px;
    pointer-events: none;
}

#signal-year {
    position: absolute;
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%);
    font-size: var(--text-xs);
    color: var(--text-secondary);
}

#signal-decode {
    position: absolute;
    top: 10px;
    right: var(--space-xl);
    font-size: var(--text-xs);
    color: var(--joining-glow);
    text-align: right;
}

/* ==========================================
   LIGHT CONE VISUALIZATION
   ========================================== */
#light-cone-container {
    padding: var(--space-md) 0;
}

.light-cone-header {
    display: flex;
    justify-content: center;
    margin-bottom: var(--space-md);
}

.mode-toggle {
    display: flex;
    gap: 2px;
    background: rgba(0, 0, 0, 0.3);
    padding: 2px;
    border-radius: 4px;
}

.mode-btn {
    font-family: 'JetBrains Mono', monospace;
    font-size: var(--text-xs);
    padding: var(--space-xs) var(--space-md);
    background: transparent;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.2s ease;
    border-radius: 3px;
}

.mode-btn:hover {
    color: var(--text-primary);
}

.mode-btn.active {
    background: rgba(100, 180, 200, 0.2);
    color: rgba(150, 200, 220, 1);
}

.light-cone-viz {
    position: relative;
    height: 400px;
    margin: var(--space-md) 0;
    display: flex;
    align-items: center;
    justify-content: center;
}

.earth-marker {
    position: absolute;
    z-index: 20;
    display: flex;
    flex-direction: column;
    align-items: center;
    pointer-events: none;
}

.earth-icon {
    font-size: 20px;
    color: rgba(100, 180, 220, 1);
    text-shadow: 0 0 10px rgba(100, 180, 220, 0.5);
}

.earth-label {
    font-size: 9px;
    color: var(--text-tertiary);
    margin-top: 2px;
}

.radio-sphere {
    position: absolute;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: radial-gradient(
        circle,
        rgba(100, 180, 220, 0.1) 0%,
        rgba(100, 180, 220, 0.05) 50%,
        rgba(100, 180, 220, 0.15) 90%,
        rgba(100, 180, 220, 0.3) 100%
    );
    border: 1px solid rgba(100, 180, 220, 0.4);
    transition: width 0.1s linear, height 0.1s linear;
    z-index: 5;
    pointer-events: none;
}

.sphere-label {
    position: absolute;
    bottom: -20px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 9px;
    color: rgba(100, 180, 220, 0.7);
    white-space: nowrap;
}

.stars-container {
    position: absolute;
    width: 100%;
    height: 100%;
    z-index: 10;
}

.light-cone-star {
    position: absolute;
    border-radius: 50%;
    transform: translate(-50%, -50%);
    transition: all 0.3s ease;
    cursor: pointer;
}

.light-cone-star.unreached {
    opacity: 0.3;
    filter: grayscale(0.8);
}

.light-cone-star.reached {
    opacity: 1;
    filter: grayscale(0);
    box-shadow: 0 0 8px currentColor;
    animation: star-pulse 2s ease-in-out infinite;
}

@keyframes star-pulse {
    0%, 100% { box-shadow: 0 0 4px currentColor; }
    50% { box-shadow: 0 0 12px currentColor; }
}

.distance-rings {
    position: absolute;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 1;
}

.distance-ring {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    border-radius: 50%;
    border: 1px dashed rgba(255, 255, 255, 0.1);
    --ring-size: calc(var(--ring-distance) / 150 * 360px);
    width: var(--ring-size);
    height: var(--ring-size);
}

.distance-labels {
    position: absolute;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 2;
}

.distance-label {
    position: absolute;
    top: 50%;
    left: 50%;
    font-size: 9px;
    color: var(--text-tertiary);
    --label-offset: calc(var(--label-distance) / 150 * 180px);
    transform: translate(calc(-50% + var(--label-offset)), -50%);
}

.light-cone-controls {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    margin-bottom: var(--space-md);
}

.play-btn {
    width: 36px;
    height: 36px;
    padding: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
}

.year-slider {
    flex: 1;
    height: 4px;
    -webkit-appearance: none;
    appearance: none;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 2px;
    outline: none;
}

.year-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: rgba(100, 180, 220, 0.8);
    cursor: pointer;
    transition: background 0.2s ease;
}

.year-slider::-webkit-slider-thumb:hover {
    background: rgba(100, 180, 220, 1);
}

.year-display {
    font-size: var(--text-sm);
    font-weight: 600;
    color: var(--text-primary);
    min-width: 50px;
    text-align: right;
}

.light-cone-stats {
    display: flex;
    justify-content: center;
    gap: var(--space-xl);
    margin-bottom: var(--space-md);
}

.stat {
    text-align: center;
}

.stat-value {
    display: block;
    font-size: var(--text-lg);
    font-weight: 600;
    color: rgba(100, 180, 220, 0.9);
}

.stat-label {
    font-size: var(--text-xs);
    color: var(--text-secondary);
}

.light-cone-message {
    text-align: center;
    font-size: var(--text-xs);
    color: var(--text-secondary);
    min-height: 1.5em;
    transition: all 0.3s ease;
}

.light-cone-message.highlight {
    color: rgba(200, 180, 100, 0.9);
}

/* Mobile adjustments */
@media (max-width: 480px) {
    .light-cone-viz {
        height: 300px;
    }

    .light-cone-stats {
        flex-wrap: wrap;
        gap: var(--space-md);
    }

    .stat-value {
        font-size: var(--text-md);
    }

    .distance-ring {
        --ring-size: calc(var(--ring-distance) / 150 * 280px);
    }

    .distance-label {
        --label-offset: calc(var(--label-distance) / 150 * 140px);
    }
}

/* ==========================================
   PAYOFF MATRIX VISUALIZER
   ========================================== */
#payoff-matrix-container {
    padding: var(--space-md) 0;
}

.payoff-matrix {
    display: flex;
    flex-direction: column;
    gap: 2px;
    margin-bottom: var(--space-md);
    width: 100%;
    max-width: 400px;
    margin-left: auto;
    margin-right: auto;
}

.matrix-row {
    display: flex;
    gap: 2px;
}

.matrix-cell {
    padding: var(--space-sm);
    text-align: center;
    font-size: var(--text-xs);
    flex: 1 1 0;
    min-width: 0;
}

.matrix-cell.corner {
    background: transparent;
}

.matrix-cell.header-cell {
    background: rgba(100, 140, 180, 0.15);
    color: var(--text-secondary);
    font-weight: 500;
}

.matrix-cell.row-header {
    background: rgba(180, 140, 100, 0.15);
    color: var(--text-secondary);
    font-weight: 500;
    text-align: right;
    padding-right: var(--space-md);
}

.matrix-cell.data-cell {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.3s ease;
    cursor: default;
}

.cell-payoff {
    font-size: var(--text-sm);
    font-weight: 600;
    margin-bottom: 2px;
}

.payoff-a {
    color: rgba(180, 140, 100, 0.9);
}

.payoff-b {
    color: rgba(100, 140, 180, 0.9);
}

.cell-label {
    font-size: 9px;
    color: var(--text-tertiary);
}

/* Nash equilibrium state */
.matrix-cell.nash {
    background: rgba(180, 100, 100, 0.2);
    border-color: rgba(180, 100, 100, 0.5);
    box-shadow: 0 0 10px rgba(180, 100, 100, 0.3);
}

.matrix-cell.nash .cell-payoff {
    color: rgba(200, 150, 150, 1);
}

/* Pareto optimal state */
.matrix-cell.pareto {
    background: rgba(100, 180, 120, 0.15);
    border-color: rgba(100, 180, 120, 0.4);
}

/* Reasoning animation states */
.matrix-cell.reasoning {
    background: rgba(170, 204, 255, 0.15);
    border-color: rgba(170, 204, 255, 0.5);
    animation: reasoning-pulse 0.5s ease infinite alternate;
}

@keyframes reasoning-pulse {
    from { box-shadow: 0 0 5px rgba(170, 204, 255, 0.3); }
    to { box-shadow: 0 0 15px rgba(170, 204, 255, 0.5); }
}

.matrix-cell.dominated {
    opacity: 0.4;
    background: rgba(100, 100, 100, 0.1);
    border-style: dashed;
}

/* Legend */
.matrix-legend {
    display: flex;
    gap: var(--space-lg);
    margin-bottom: var(--space-md);
    font-size: var(--text-xs);
    color: var(--text-secondary);
}

.legend-item {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
}

.legend-color {
    width: 12px;
    height: 12px;
    border-radius: 2px;
}

.legend-color.nash {
    background: rgba(180, 100, 100, 0.4);
    border: 1px solid rgba(180, 100, 100, 0.6);
}

.legend-color.pareto {
    background: rgba(100, 180, 120, 0.3);
    border: 1px solid rgba(100, 180, 120, 0.5);
}

/* Status message */
.matrix-status {
    font-size: var(--text-xs);
    color: var(--text-secondary);
    line-height: 1.5;
    min-height: 3em;
    margin-bottom: var(--space-md);
    padding: var(--space-sm);
    background: rgba(0, 0, 0, 0.2);
    border-left: 2px solid rgba(255, 255, 255, 0.1);
}

/* Controls */
.matrix-controls {
    margin-bottom: var(--space-md);
}

/* Sliders section */
.sliders-section {
    margin-top: var(--space-md);
    font-size: var(--text-xs);
}

.sliders-section summary {
    cursor: pointer;
    color: var(--text-secondary);
    padding: var(--space-xs) 0;
}

.sliders-section summary:hover {
    color: var(--text-primary);
}

.sliders-content {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--space-md);
    padding: var(--space-md) 0;
}

.slider-group {
    background: rgba(0, 0, 0, 0.2);
    padding: var(--space-sm);
    border-radius: 4px;
}

.slider-group-label {
    font-weight: 500;
    color: var(--text-secondary);
    margin-bottom: var(--space-xs);
    font-size: 10px;
}

.payoff-slider {
    display: flex;
    flex-direction: column;
    gap: 2px;
    margin-top: var(--space-xs);
}

.payoff-slider label {
    font-size: 10px;
    color: var(--text-tertiary);
}

.slider-value {
    color: var(--text-primary);
    font-weight: 600;
}

.payoff-slider input[type="range"] {
    width: 100%;
    height: 4px;
    -webkit-appearance: none;
    appearance: none;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 2px;
    outline: none;
}

.payoff-slider input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: var(--text-secondary);
    cursor: pointer;
    transition: background 0.2s ease;
}

.payoff-slider input[type="range"]::-webkit-slider-thumb:hover {
    background: var(--text-primary);
}

/* Mobile adjustments */
@media (max-width: 480px) {
    .payoff-matrix {
        max-width: 100%;
    }

    .matrix-cell {
        padding: var(--space-xs);
        font-size: 10px;
    }

    .matrix-cell.header-cell,
    .matrix-cell.row-header {
        font-size: 9px;
        padding: var(--space-xs) 4px;
    }

    .cell-payoff {
        font-size: var(--text-xs);
    }

    .matrix-legend {
        flex-direction: column;
        gap: var(--space-xs);
    }

    .sliders-content {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 360px) {
    .matrix-cell.header-cell,
    .matrix-cell.row-header {
        font-size: 8px;
    }

    .cell-payoff {
        font-size: 11px;
    }

    .cell-label {
        font-size: 7px;
    }
}

/* ==========================================
   SUSPICION CHAIN BUILDER
   ========================================== */
#suspicion-chain-container {
    height: 380px;
    position: relative;
    margin: var(--space-lg) 0;
}

.chain-step {
    position: absolute;
    width: 120px;
    padding: var(--space-sm);
    background: rgba(0, 0, 0, 0.4);
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.3s ease;
    z-index: 10;
}

.chain-step:hover {
    border-color: rgba(255, 255, 255, 0.3);
    background: rgba(0, 0, 0, 0.5);
}

.chain-step.selected {
    border-color: var(--blue-giant);
    box-shadow: 0 0 15px rgba(170, 204, 255, 0.3);
}

.chain-step.connected {
    border-color: rgba(100, 180, 120, 0.5);
    background: rgba(100, 180, 120, 0.08);
}

.chain-step.connected.origin {
    border-color: rgba(200, 180, 100, 0.5);
    background: rgba(200, 180, 100, 0.1);
}

.chain-step.invalid {
    border-color: var(--danger-red);
    animation: chain-invalid-shake 0.3s ease;
}

@keyframes chain-invalid-shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-5px); }
    75% { transform: translateX(5px); }
}

.chain-step.trapped {
    border-color: rgba(180, 100, 100, 0.6);
    background: rgba(180, 100, 100, 0.15);
    transform: scale(0.95);
}

.chain-step-title {
    font-size: var(--text-xs);
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: var(--space-xs);
}

.chain-step-desc {
    font-size: 10px;
    color: var(--text-secondary);
    line-height: 1.4;
}

.chain-connection {
    position: absolute;
    height: 2px;
    background: linear-gradient(90deg,
        rgba(100, 180, 120, 0.6),
        rgba(100, 180, 120, 0.3)
    );
    transform-origin: left center;
    opacity: 0;
    transition: opacity 0.4s ease;
    z-index: 5;
    pointer-events: none;
}

.chain-connection.active {
    opacity: 1;
}

.chain-connection::after {
    content: 'â†’';
    position: absolute;
    right: -5px;
    top: 50%;
    transform: translateY(-50%);
    color: rgba(100, 180, 120, 0.8);
    font-size: 12px;
}

.chain-message {
    position: absolute;
    bottom: 5px;
    left: 50%;
    transform: translateX(-50%);
    font-size: var(--text-xs);
    color: var(--text-secondary);
    text-align: center;
    transition: all 0.5s ease;
    z-index: 15;
    background: rgba(10, 12, 20, 0.9);
    padding: 4px 12px;
    border-radius: 4px;
    max-width: 90%;
}

.chain-message.complete {
    color: rgba(180, 100, 100, 0.9);
    font-style: italic;
}

#suspicion-chain-container.complete .chain-step {
    cursor: default;
}

#suspicion-chain-container.complete .chain-connection {
    background: linear-gradient(90deg,
        rgba(180, 100, 100, 0.6),
        rgba(180, 100, 100, 0.3)
    );
}

#suspicion-chain-container.complete .chain-connection::after {
    color: rgba(180, 100, 100, 0.8);
}

/* Mobile adjustments */
@media (max-width: 480px) {
    #suspicion-chain-container {
        height: 420px;
    }

    .chain-step {
        width: 100px;
        padding: var(--space-xs);
    }

    .chain-step-title {
        font-size: 10px;
    }

    .chain-step-desc {
        font-size: 9px;
    }
}

/* ==========================================
   CHAIN VISUALIZATION
   ========================================== */
#chain-container {
    height: 140px;
    position: relative;
    overflow: hidden;
}

.chain-node {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    text-align: center;
    font-size: 9px;
    line-height: 1.3;
    transition: all 0.4s ease;
}

.chain-node.active {
    color: var(--joining-glow) !important;
    text-shadow: 0 0 20px var(--joining-magenta);
    transform: translateY(-50%) scale(1.1);
}

.chain-node.dead {
    color: var(--danger-red) !important;
    opacity: 0.4;
}

.chain-arrow {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-tertiary);
    opacity: 0.4;
    transition: all 0.3s ease;
}

.chain-arrow.active {
    color: var(--joining-glow);
    opacity: 1;
}

/* ==========================================
   JOINING VISUALIZATION
   ========================================== */
#joining-container {
    height: 260px;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 25px;
}

.individual-marker {
    position: absolute;
    font-size: 14px;
    color: var(--text-secondary);
    transition: all 2.5s cubic-bezier(0.4, 0, 0.2, 1);
    opacity: 0.7;
}

.individual-marker.converging {
    opacity: 0;
    transform: scale(0.5);
}

.individual-marker.resisting {
    color: var(--danger-red) !important;
    opacity: 1 !important;
    text-shadow: 0 0 10px var(--danger-red);
}

#collective-core {
    position: absolute;
    font-size: 10px;
    color: var(--joining-glow);
    text-align: center;
    opacity: 0;
    transition: opacity 1.5s ease 1.5s;
}

#collective-core.visible {
    opacity: 1;
}

#joining-status {
    position: absolute;
    bottom: -20px;
    left: 50%;
    transform: translateX(-50%);
    font-size: var(--text-xs);
    color: var(--text-secondary);
    white-space: nowrap;
}

/* ==========================================
   CAROL VS HIVE
   ========================================== */
#carol-container {
    height: 240px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 var(--space-xl);
    position: relative;
}

#carol-figure {
    font-size: 12px;
    white-space: pre;
    color: var(--danger-red);
    animation: carol-breathe 4s ease-in-out infinite;
}

@keyframes carol-breathe {
    0%, 100% { transform: scaleY(1) translateY(0); }
    50% { transform: scaleY(1.02) translateY(-2px); }
}

#hive-crowd {
    font-size: 10px;
    white-space: pre;
    text-align: right;
    color: var(--joining-glow);
    animation: hive-pulse 2.5s ease-in-out infinite;
}

@keyframes hive-pulse {
    0%, 100% { opacity: 0.6; }
    50% { opacity: 1; }
}

#choice-text {
    position: absolute;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    font-size: var(--text-xs);
    text-align: center;
}

.choice-option {
    display: block;
    margin: var(--space-sm) 0;
    opacity: 0.3;
    transition: all 0.4s ease;
    font-weight: 500;
}

.choice-option.active {
    opacity: 1;
}

/* Carol Choice Interactive */
#carol-choice-container {
    position: relative;
}

.choice-option {
    cursor: pointer;
    transition: all 0.4s ease;
}

.choice-option:hover {
    opacity: 1;
    text-shadow: 0 0 10px currentColor;
}

.choice-option.oscillating {
    animation: choice-breathe 3s ease-in-out infinite;
}

.choice-option.highlight {
    opacity: 0.9;
    text-shadow: 0 0 8px currentColor;
}

.choice-option.chosen {
    opacity: 1;
    text-shadow: 0 0 15px currentColor, 0 0 30px currentColor;
    animation: choice-pulse 2s ease-in-out infinite;
}

.choice-option.not-chosen {
    opacity: 0.15;
    text-decoration: line-through;
    pointer-events: none;
}

@keyframes choice-breathe {
    0%, 100% { opacity: 0.3; }
    50% { opacity: 0.6; }
}

@keyframes choice-pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.8; text-shadow: 0 0 20px currentColor, 0 0 40px currentColor; }
}

.choice-prompt {
    position: absolute;
    bottom: -25px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 10px;
    color: var(--text-tertiary);
    opacity: 0.6;
    animation: prompt-pulse 2s ease-in-out infinite;
    transition: opacity 0.5s ease;
}

.choice-prompt.hidden {
    opacity: 0;
    pointer-events: none;
}

@keyframes prompt-pulse {
    0%, 100% { opacity: 0.4; }
    50% { opacity: 0.8; }
}

.choice-response {
    position: absolute;
    bottom: -30px;
    left: 50%;
    transform: translateX(-50%);
    width: 100%;
    text-align: center;
    opacity: 0;
    transition: opacity 0.8s ease;
}

.choice-response.visible {
    opacity: 1;
}

.choice-response .response-text {
    display: block;
    font-size: 10px;
    color: var(--text-secondary);
    font-style: italic;
}

.choice-response .response-time {
    display: block;
    font-size: 9px;
    color: var(--text-tertiary);
    margin-top: 4px;
}

/* Container state classes */
#carol-choice-container.choice-made #carol-figure {
    opacity: 0.6;
}

#carol-choice-container.chose-world #bomb-crate {
    animation: bomb-chosen 1s ease forwards;
}

#carol-choice-container.chose-girl #hive-crowd {
    opacity: 0.3;
}

@keyframes bomb-chosen {
    to {
        text-shadow: 0 0 30px var(--warning-amber), 0 0 60px rgba(196, 92, 92, 0.8);
        color: var(--warning-amber);
    }
}

#bomb-crate {
    position: absolute;
    bottom: 30px;
    left: 15%;
    font-size: 10px;
    color: var(--warning-amber);
    animation: bomb-glow 2s ease-in-out infinite;
}

@keyframes bomb-glow {
    0%, 100% { text-shadow: 0 0 5px rgba(212, 165, 116, 0.5); }
    50% { text-shadow: 0 0 15px var(--warning-amber), 0 0 30px rgba(196, 92, 92, 0.5); }
}

/* ==========================================
   WINDOW VISUALIZATION
   ========================================== */
#window-container {
    height: 180px;
    display: flex;
    align-items: stretch;
    position: relative;
}

.window-section {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    font-size: var(--text-xs);
    padding: var(--space-md);
}

.window-section.past {
    color: var(--text-tertiary);
}

.window-section.present {
    background: rgba(138, 74, 107, 0.1);
    border-left: 1px solid var(--joining-magenta);
    border-right: 1px solid var(--joining-magenta);
    color: var(--text-primary);
}

.window-section.future {
    color: var(--joining-glow);
    opacity: 0.8;
}

.window-section h4 {
    font-size: var(--text-xs);
    font-weight: 600;
    margin-bottom: var(--space-md);
    letter-spacing: 0.1em;
}

.window-section .figures {
    font-size: 12px;
    line-height: 1.3;
    margin-bottom: var(--space-md);
    letter-spacing: 2px;
}

.window-section .description {
    font-size: 9px;
    opacity: 0.8;
    line-height: 1.5;
}

#window-closing {
    position: absolute;
    top: 0;
    bottom: 0;
    width: 3px;
    background: var(--danger-red);
    box-shadow: 0 0 10px var(--danger-red);
    z-index: 10;
}

/* ==========================================
   MIRROR
   ========================================== */
#mirror-container {
    height: 220px;
    display: flex;
    position: relative;
    margin-bottom: 30px;
    cursor: pointer;
}

.mirror-side {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    white-space: pre;
    line-height: 1.3;
}

.mirror-side.left {
    color: var(--hope-teal);
}

.mirror-divide {
    width: 1px;
    background: linear-gradient(to bottom, transparent 10%, var(--text-tertiary) 50%, transparent 90%);
}

#reflection {
    color: var(--danger-red);
}

#mirror-label {
    position: absolute;
    bottom: -25px;
    left: 50%;
    transform: translateX(-50%);
    font-size: var(--text-xs);
    color: var(--text-secondary);
    font-style: italic;
    white-space: nowrap;
}

/* ==========================================
   RESPONSIVE
   ========================================== */
@media (max-width: 768px) {
    .ascii-interactive .ascii-content {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
    }

    .ascii-interactive .ascii-header {
        padding: var(--space-sm) var(--space-md);
        flex-direction: column;
        align-items: stretch;
        gap: var(--space-sm);
    }

    .forest-layer {
        font-size: 10px;
    }

    .glass-node {
        font-size: 22px;
    }

    #thermo-core {
        font-size: 9px;
    }

    .signal-source, .signal-dest {
        font-size: 8px;
    }

    .chain-node {
        font-size: 8px;
    }

    .mirror-side {
        font-size: 9px;
    }

    #carol-container {
        flex-direction: column;
        height: auto;
        padding: var(--space-lg);
        gap: var(--space-lg);
    }

    #choice-text {
        position: relative;
        top: auto;
        left: auto;
        transform: none;
        order: -1;
    }

    #bomb-crate {
        position: relative;
        left: auto;
        bottom: auto;
    }

    /* Holdout interactive mobile fixes */
    #carol-choice-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: var(--space-md);
        padding: var(--space-md);
        overflow: hidden;
    }

    #carol-choice-container #carol-figure {
        font-size: 10px;
        transform: scale(0.9);
    }

    #carol-choice-container #hive-crowd {
        font-size: 8px;
        transform: scale(0.85);
        text-align: center;
    }

    #carol-choice-container #choice-text {
        order: 0;
    }

    #carol-choice-container #bomb-crate {
        font-size: 9px;
        display: none;
    }

    .ascii-star {
        transition: opacity 0.2s ease-out;
    }
}

/* Small phones */
@media (max-width: 480px) {
    .ascii-interactive .ascii-content {
        min-height: 200px;
    }

    #glass-forest-container {
        height: 280px;
    }

    #glass-phase {
        font-size: 0.625rem;
        padding: var(--space-xs) var(--space-sm);
    }

    #glass-message {
        font-size: 0.625rem;
    }

    #signal-container {
        height: 140px;
        padding: 0 var(--space-md);
    }

    #joining-container {
        height: 200px;
    }

    #window-container {
        flex-direction: column;
        height: auto;
        min-height: 320px;
    }

    .window-section {
        border-left: none;
        border-right: none;
        border-bottom: 1px solid rgba(255,255,255,0.06);
    }

    .window-section.present {
        border-left: none;
        border-right: none;
        border-top: 1px solid var(--joining-magenta);
        border-bottom: 1px solid var(--joining-magenta);
    }

    #window-closing {
        width: 100%;
        height: 3px;
        top: auto;
        left: 0;
        right: 0;
        bottom: 33.33%;
    }

    #mirror-container {
        flex-direction: column;
        height: 260px;
        min-height: unset;
        overflow: hidden;
    }

    .mirror-divide {
        width: 100%;
        height: 1px;
        flex-shrink: 0;
    }

    .mirror-side {
        flex: 1;
        min-height: 0;
        overflow: hidden;
    }

    #star-layer-1 .ascii-star:nth-child(2n) {
        display: none;
    }
}

/* Touch device interactions */
@media (pointer: coarse) {
    .forest-eye {
        font-size: 24px;
    }

    .forest-eye:hover {
        text-shadow:
            0 0 10px currentColor,
            0 0 20px currentColor,
            0 0 40px rgba(255, 100, 100, 0.3);
    }

    .glass-node {
        font-size: 24px;
        padding: 12px;
        margin: -12px;
    }

    .glass-node:hover {
        transform: none;
        filter: none;
    }

    .glass-node:active {
        transform: scale(1.3);
        filter: brightness(1.3);
    }
}

/* ==========================================
   THE TRANSMISSION
   ========================================== */
#transmission-container {
    padding: var(--space-lg);
    min-height: 400px;
    position: relative;
}

.transmission-input-section {
    max-width: 600px;
    margin: 0 auto;
    transition: opacity 0.5s ease, transform 0.5s ease;
}

#transmission-container.submitted .transmission-input-section {
    opacity: 0;
    transform: translateY(-20px);
    pointer-events: none;
    position: absolute;
    width: 100%;
}

.transmission-prompt {
    text-align: center;
    margin-bottom: var(--space-lg);
}

.transmission-prompt .prompt-main {
    font-size: var(--text-md);
    color: var(--text-primary);
    margin-bottom: var(--space-sm);
}

.transmission-prompt .prompt-sub {
    font-size: var(--text-sm);
    color: var(--text-secondary);
    font-style: italic;
}

.transmission-input {
    width: 100%;
    min-height: 120px;
    padding: var(--space-md);
    background: rgba(0, 0, 0, 0.4);
    border: 1px solid rgba(100, 180, 220, 0.3);
    border-radius: 4px;
    color: var(--text-primary);
    font-family: 'JetBrains Mono', monospace;
    font-size: var(--text-sm);
    resize: vertical;
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
}

.transmission-input:focus {
    outline: none;
    border-color: rgba(100, 180, 220, 0.6);
    box-shadow: 0 0 20px rgba(100, 180, 220, 0.1);
}

.transmission-input::placeholder {
    color: var(--text-tertiary);
    font-style: italic;
}

.transmission-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: var(--space-md);
}

.char-count {
    font-size: var(--text-xs);
    color: var(--text-tertiary);
    transition: color 0.3s ease;
}

.char-count.warning {
    color: var(--warning-amber);
}

.char-count.danger {
    color: var(--danger-red);
}

.transmission-send {
    background: rgba(100, 180, 220, 0.1);
    border-color: rgba(100, 180, 220, 0.4);
    color: rgba(100, 180, 220, 0.9);
}

.transmission-send:hover:not(:disabled) {
    background: rgba(100, 180, 220, 0.2);
    border-color: rgba(100, 180, 220, 0.6);
}

.transmission-send:disabled {
    opacity: 0.3;
    cursor: not-allowed;
}

/* Journey Visualization */
.transmission-journey {
    position: relative;
    height: 300px;
    opacity: 0;
    transition: opacity 0.5s ease;
    overflow: visible;
}

.transmission-journey.active {
    opacity: 1;
}

.traveling-message {
    position: absolute;
    bottom: 20%;
    left: 50%;
    transform: translateX(-50%);
    font-size: var(--text-xs);
    color: rgba(100, 180, 220, 0.9);
    text-align: center;
    max-width: 200px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    animation: messageDepart 8s ease-out forwards;
    text-shadow: 0 0 10px rgba(100, 180, 220, 0.5);
}

@keyframes messageDepart {
    0% {
        bottom: 20%;
        opacity: 1;
        transform: translateX(-50%) scale(1);
    }
    100% {
        bottom: 90%;
        opacity: 0;
        transform: translateX(-50%) scale(0.3);
    }
}

.transmission-ring {
    position: absolute;
    bottom: 15%;
    left: 50%;
    width: 10px;
    height: 10px;
    border: 1px solid rgba(100, 180, 220, 0.6);
    border-radius: 50%;
    transform: translate(-50%, 50%);
    animation: ringExpand 4s ease-out forwards;
    pointer-events: none;
}

@keyframes ringExpand {
    0% {
        width: 10px;
        height: 10px;
        opacity: 0.8;
    }
    100% {
        width: 600px;
        height: 600px;
        opacity: 0;
    }
}

.transmission-star {
    position: absolute;
    width: 4px;
    height: 4px;
    background: rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    opacity: 0;
    animation: starReached 1s ease-out forwards;
}

.transmission-star::before {
    content: attr(data-name);
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    font-size: 8px;
    color: var(--text-tertiary);
    white-space: nowrap;
    margin-top: 4px;
    opacity: 0;
    animation: labelFadeIn 0.5s ease-out 0.5s forwards;
}

@keyframes starReached {
    0% {
        opacity: 0;
        transform: scale(0.5);
        background: rgba(255, 255, 255, 0.3);
    }
    50% {
        opacity: 1;
        background: rgba(100, 180, 220, 1);
        box-shadow: 0 0 20px rgba(100, 180, 220, 0.8);
    }
    100% {
        opacity: 0.6;
        transform: scale(1);
        background: rgba(100, 180, 220, 0.6);
        box-shadow: 0 0 8px rgba(100, 180, 220, 0.4);
    }
}

@keyframes labelFadeIn {
    to { opacity: 1; }
}

/* Questions */
.transmission-questions {
    max-width: 500px;
    margin: var(--space-xl) auto 0;
    text-align: center;
    position: relative;
    z-index: 5;
    background: transparent;
}

.transmission-question {
    font-size: var(--text-sm);
    color: var(--text-secondary);
    margin-bottom: var(--space-md);
    opacity: 0;
    transform: translateY(10px);
    transition: opacity 0.6s ease, transform 0.6s ease;
    font-style: italic;
}

.transmission-question.visible {
    opacity: 1;
    transform: translateY(0);
}

.transmission-question::before {
    content: '"';
    color: var(--text-tertiary);
}

.transmission-question::after {
    content: '"';
    color: var(--text-tertiary);
}

.transmission-reflection {
    margin-top: var(--space-xl);
    padding-top: var(--space-lg);
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    opacity: 0;
    transform: translateY(10px);
    transition: opacity 0.8s ease, transform 0.8s ease;
}

.transmission-reflection.visible {
    opacity: 1;
    transform: translateY(0);
}

.transmission-reflection p {
    font-size: var(--text-xs);
    color: var(--text-tertiary);
    margin-bottom: var(--space-sm);
}

.transmission-reflection .reflection-final {
    margin-top: var(--space-md);
    font-size: var(--text-sm);
    color: var(--text-secondary);
    font-style: italic;
}

/* Mobile adjustments */
@media (max-width: 480px) {
    #transmission-container {
        padding: var(--space-md);
    }

    .transmission-input {
        min-height: 100px;
        /* 16px minimum prevents iOS Safari zoom on focus */
        font-size: 16px;
    }

    .transmission-journey {
        height: 250px;
    }

    .transmission-question {
        font-size: var(--text-xs);
    }
}

/* ==========================================
   CREDENCE COLLECTOR
   ========================================== */
#credence-container {
    padding: var(--space-lg);
    position: relative;
}

.credence-input-section {
    max-width: 700px;
    margin: 0 auto;
    transition: opacity 0.5s ease, transform 0.5s ease;
}

#credence-container.submitted .credence-input-section {
    opacity: 0.3;
    transform: scale(0.95);
    pointer-events: none;
}

.credence-intro {
    text-align: center;
    margin-bottom: var(--space-xl);
}

.credence-intro .intro-main {
    font-size: var(--text-md);
    color: var(--text-primary);
    margin-bottom: var(--space-sm);
}

.credence-intro .intro-sub {
    font-size: var(--text-sm);
    color: var(--text-secondary);
    font-style: italic;
}

.credence-sliders {
    display: flex;
    flex-direction: column;
    gap: var(--space-lg);
    margin-bottom: var(--space-xl);
}

.credence-row {
    display: flex;
    align-items: center;
    gap: var(--space-lg);
}

.credence-label {
    flex: 0 0 45%;
    text-align: right;
}

.credence-label .label-text {
    display: block;
    font-size: var(--text-sm);
    color: var(--text-primary);
    font-weight: 500;
}

.credence-label .label-description {
    display: block;
    font-size: var(--text-xs);
    color: var(--text-tertiary);
    margin-top: 2px;
}

.credence-slider-container {
    flex: 1;
    display: flex;
    align-items: center;
    gap: var(--space-sm);
}

.credence-slider {
    flex: 1;
    height: 6px;
    -webkit-appearance: none;
    appearance: none;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 3px;
    outline: none;
}

.credence-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: rgba(180, 160, 200, 0.8);
    cursor: pointer;
    transition: all 0.2s ease;
    border: 2px solid rgba(180, 160, 200, 0.4);
}

.credence-slider::-webkit-slider-thumb:hover {
    background: rgba(180, 160, 200, 1);
    transform: scale(1.1);
}

.credence-slider::-moz-range-thumb {
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: rgba(180, 160, 200, 0.8);
    cursor: pointer;
    border: 2px solid rgba(180, 160, 200, 0.4);
}

.credence-value {
    min-width: 45px;
    text-align: right;
    font-size: var(--text-sm);
    color: rgba(180, 160, 200, 0.9);
    font-weight: 500;
}

.credence-submit {
    display: block;
    margin: 0 auto;
    background: rgba(180, 160, 200, 0.1);
    border-color: rgba(180, 160, 200, 0.4);
    color: rgba(180, 160, 200, 0.9);
}

.credence-submit:hover {
    background: rgba(180, 160, 200, 0.2);
    border-color: rgba(180, 160, 200, 0.6);
}

/* Collective Map */
.credence-map {
    position: relative;
    height: 400px;
    margin-top: var(--space-xl);
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.6s ease, transform 0.6s ease;
}

.credence-map.visible {
    opacity: 1;
    transform: translateY(0);
}

.map-axes {
    position: absolute;
    inset: 0;
    pointer-events: none;
}

.axis-label {
    position: absolute;
    font-size: 10px;
    color: var(--text-tertiary);
    text-transform: uppercase;
    letter-spacing: 0.1em;
}

.axis-label.axis-top {
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
}

.axis-label.axis-bottom {
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%);
}

.axis-label.axis-left {
    left: 10px;
    top: 50%;
    transform: translateY(-50%) rotate(-90deg);
    transform-origin: center;
}

.axis-label.axis-right {
    right: 10px;
    top: 50%;
    transform: translateY(-50%) rotate(90deg);
    transform-origin: center;
}

.map-dots {
    position: absolute;
    inset: 40px;
    background:
        linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
    background-size: 20% 20%;
    border: 1px solid rgba(255, 255, 255, 0.05);
    border-radius: 4px;
}

.map-dot {
    position: absolute;
    border-radius: 50%;
    transform: translate(-50%, -50%);
}

.map-dot.other {
    width: 4px;
    height: 4px;
    background: rgba(180, 160, 200, 0.3);
    opacity: 0;
    animation: dotFadeIn 0.5s ease forwards;
}

@keyframes dotFadeIn {
    to {
        opacity: 1;
    }
}

.map-dot.user {
    width: 12px;
    height: 12px;
    background: rgba(100, 200, 180, 0.9);
    box-shadow: 0 0 15px rgba(100, 200, 180, 0.6), 0 0 30px rgba(100, 200, 180, 0.3);
    z-index: 10;
    animation: userPulse 2s ease-in-out infinite;
}

@keyframes userPulse {
    0%, 100% {
        box-shadow: 0 0 15px rgba(100, 200, 180, 0.6), 0 0 30px rgba(100, 200, 180, 0.3);
    }
    50% {
        box-shadow: 0 0 20px rgba(100, 200, 180, 0.8), 0 0 40px rgba(100, 200, 180, 0.5);
    }
}

.user-label {
    position: absolute;
    top: -20px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 10px;
    color: rgba(100, 200, 180, 0.9);
    white-space: nowrap;
    font-weight: 500;
}

.cluster-info {
    position: absolute;
    bottom: -80px;
    left: 50%;
    transform: translateX(-50%);
    text-align: center;
    max-width: 400px;
}

.cluster-info .cluster-name {
    font-size: var(--text-md);
    color: rgba(100, 200, 180, 0.9);
    font-weight: 600;
    margin-bottom: var(--space-xs);
}

.cluster-info .cluster-description {
    font-size: var(--text-sm);
    color: var(--text-secondary);
    margin-bottom: var(--space-xs);
}

.cluster-info .cluster-stats {
    font-size: var(--text-xs);
    color: var(--text-tertiary);
    font-style: italic;
}

/* Mobile adjustments for credence */
@media (max-width: 768px) {
    .credence-row {
        flex-direction: column;
        align-items: stretch;
        gap: var(--space-sm);
    }

    .credence-label {
        text-align: left;
    }

    .credence-map {
        height: 300px;
        margin-bottom: 120px;
    }

    .map-dots {
        inset: 30px;
    }

    .axis-label {
        font-size: 8px;
    }

    .cluster-info {
        bottom: -110px;
        max-width: 90%;
    }

    .cluster-info .cluster-name {
        font-size: var(--text-sm);
    }

    .cluster-info .cluster-description {
        font-size: var(--text-xs);
    }
}

@media (max-width: 480px) {
    #credence-container {
        padding: var(--space-md);
    }

    .credence-sliders {
        gap: var(--space-md);
    }

    .credence-label .label-description {
        display: none;
    }

    .credence-map {
        /* Enough height for chart + labels + cluster info */
        height: auto;
        min-height: 280px;
        margin-bottom: var(--space-xl);
        padding-top: 24px;
        padding-bottom: 24px;
    }

    .map-axes {
        position: absolute;
        inset: 0;
        pointer-events: none;
    }

    .map-dots {
        /* Chart area with room for axis labels */
        position: relative;
        height: 180px;
        margin: 0;
        inset: auto;
    }

    /* Axis labels positioned clearly outside the chart */
    .axis-label {
        font-size: 9px;
        letter-spacing: 0.05em;
        background: rgba(10, 12, 20, 0.9);
        padding: 2px 8px;
        border-radius: 3px;
    }

    .axis-label.axis-top {
        top: 0;
        left: 50%;
        transform: translateX(-50%);
    }

    .axis-label.axis-bottom {
        bottom: 0;
        top: auto;
        left: 50%;
        transform: translateX(-50%);
    }

    .axis-label.axis-left,
    .axis-label.axis-right {
        /* Hide rotated labels - they take too much space */
        display: none;
    }

    .cluster-info {
        /* Position below the chart, not overlapping */
        position: relative;
        bottom: auto;
        transform: none;
        left: auto;
        margin-top: var(--space-lg);
        max-width: 100%;
        padding: var(--space-md);
        background: rgba(10, 10, 20, 0.6);
        border: 1px solid rgba(100, 200, 180, 0.2);
        border-radius: 8px;
        text-align: center;
    }

    .cluster-info .cluster-name {
        font-size: var(--text-md);
        margin-bottom: var(--space-xs);
    }

    .cluster-info .cluster-description {
        font-size: 12px;
        line-height: 1.5;
    }

    .cluster-info .cluster-stats {
        font-size: 11px;
        margin-top: var(--space-xs);
    }
}

@media (max-width: 360px) {
    .credence-map {
        min-height: 250px;
        padding-top: 20px;
        padding-bottom: 20px;
    }

    .map-dots {
        height: 150px;
    }

    .axis-label.axis-top,
    .axis-label.axis-bottom {
        font-size: 8px;
        padding: 2px 6px;
    }

    .cluster-info {
        padding: var(--space-sm);
    }

    .cluster-info .cluster-name {
        font-size: var(--text-sm);
    }

    .cluster-info .cluster-description {
        font-size: 11px;
    }
}

/* ===========================================================================
   THE REAL SKY
   A transition from stylized to realistic night sky
   =========================================================================== */

.real-sky-section {
    min-height: 100vh;
    background: #0a0a18;
    position: relative;
    overflow: hidden;
}

#real-sky-container {
    position: relative;
    width: 100%;
    height: 80vh;
    min-height: 500px;
    opacity: 0;
    transition: opacity 2s ease;
}

#real-sky-container.visible {
    opacity: 1;
}

.real-sky-canvas {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
}

.real-sky-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    padding: var(--space-xl);
    pointer-events: none;
    z-index: 10;
}

.real-sky-header {
    text-align: center;
    animation: fadeInDown 1.5s ease 0.5s both;
}

@keyframes fadeInDown {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.real-sky-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: clamp(1.5rem, 4vw, 2.5rem);
    color: var(--starlight);
    margin-bottom: var(--space-sm);
    text-shadow: 0 0 30px rgba(200, 220, 255, 0.5);
}

.real-sky-location {
    font-family: var(--font-mono);
    font-size: 0.85rem;
    color: var(--text-tertiary);
    letter-spacing: 0.1em;
    text-transform: uppercase;
}

.real-sky-info {
    text-align: center;
    animation: fadeIn 1.5s ease 1s both;
}

.real-sky-constellations {
    font-family: 'Spectral', Georgia, serif;
    font-size: 1.1rem;
    color: rgba(180, 200, 230, 0.7);
    font-style: italic;
}

.real-sky-prompt {
    text-align: center;
    animation: fadeInUp 1.5s ease 1.5s both;
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.prompt-text {
    font-family: 'Cormorant Garamond', serif;
    font-size: clamp(1.2rem, 3vw, 1.8rem);
    color: var(--starlight);
    margin-bottom: var(--space-sm);
}

.prompt-sub {
    font-family: 'Spectral', Georgia, serif;
    font-size: 1rem;
    color: var(--text-tertiary);
    max-width: 500px;
    margin: 0 auto;
}

.distance-annotations {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 5;
}

.distance-annotation {
    position: absolute;
    transform: translate(-50%, 0);
    text-align: center;
    animation: fadeIn 2s ease 2s both;
}

.distance-annotation .star-name {
    display: block;
    font-family: var(--font-mono);
    font-size: 0.75rem;
    color: rgba(180, 200, 230, 0.8);
    margin-bottom: 2px;
}

.distance-annotation .star-distance {
    display: block;
    font-family: var(--font-mono);
    font-size: 0.65rem;
    color: rgba(150, 170, 200, 0.6);
}

/* Real Sky responsive */
@media (max-width: 768px) {
    #real-sky-container {
        height: 70vh;
        min-height: 400px;
    }

    .real-sky-overlay {
        padding: var(--space-lg);
    }

    .real-sky-title {
        font-size: 1.5rem;
    }

    .real-sky-location {
        font-size: 0.75rem;
    }

    .real-sky-constellations {
        font-size: 0.95rem;
    }

    .prompt-text {
        font-size: 1.2rem;
    }

    .prompt-sub {
        font-size: 0.9rem;
    }

    .distance-annotation {
        display: none;
    }
}

@media (max-width: 480px) {
    #real-sky-container {
        height: 60vh;
        min-height: 350px;
    }

    .real-sky-overlay {
        padding: var(--space-md);
        gap: var(--space-md);
    }

    .real-sky-header {
        margin-bottom: auto;
    }

    .real-sky-info {
        flex-shrink: 0;
    }

    .real-sky-prompt {
        margin-top: auto;
    }

    .real-sky-title {
        font-size: 1.25rem;
        margin-bottom: var(--space-xs);
    }

    .real-sky-location {
        font-size: 0.7rem;
    }

    .real-sky-constellations {
        font-size: 0.85rem;
        line-height: 1.4;
    }

    .prompt-text {
        font-size: 1rem;
    }

    .prompt-sub {
        font-size: 0.8rem;
        line-height: 1.4;
    }
}

/* Real Sky Permission Prompt */
.real-sky-permission {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(180deg, #0a0a18 0%, #0d0d1f 50%, #101020 100%);
    animation: fadeIn 0.5s ease;
}

.permission-content {
    text-align: center;
    max-width: 500px;
    padding: var(--space-xl);
}

.permission-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: clamp(1.5rem, 4vw, 2rem);
    color: var(--starlight);
    margin-bottom: var(--space-lg);
    text-shadow: 0 0 30px rgba(200, 220, 255, 0.3);
}

.permission-description {
    font-family: 'Spectral', Georgia, serif;
    font-size: 1rem;
    color: var(--text-secondary);
    line-height: 1.7;
    margin-bottom: var(--space-xl);
}

.permission-buttons {
    display: flex;
    flex-direction: column;
    gap: var(--space-md);
    align-items: center;
}

.permission-buttons .ascii-btn {
    min-width: 200px;
}

.permission-allow {
    background: rgba(106, 158, 158, 0.15);
    border-color: var(--hope-teal);
}

.permission-allow:hover {
    background: rgba(106, 158, 158, 0.3);
}

.permission-skip {
    background: transparent;
    border-color: var(--text-tertiary);
    color: var(--text-secondary);
}

.permission-skip:hover {
    background: rgba(255, 255, 255, 0.05);
    border-color: var(--text-secondary);
}

.permission-note {
    font-family: var(--font-mono);
    font-size: 0.75rem;
    color: var(--text-tertiary);
    margin-top: var(--space-lg);
}

/* Real Sky Loading State */
.real-sky-loading {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(180deg, #0a0a18 0%, #0d0d1f 50%, #101020 100%);
}

.loading-content {
    text-align: center;
}

.loading-spinner {
    width: 40px;
    height: 40px;
    border: 2px solid rgba(200, 220, 255, 0.1);
    border-top-color: var(--starlight);
    border-radius: 50%;
    margin: 0 auto var(--space-lg);
    animation: spin 1s linear infinite;
}

@keyframes spin {
    to {
        transform: rotate(360deg);
    }
}

.loading-text {
    font-family: 'Spectral', Georgia, serif;
    font-size: 1rem;
    color: var(--text-secondary);
    font-style: italic;
}

/* Permission/Loading responsive */
@media (max-width: 480px) {
    .permission-content {
        padding: var(--space-lg);
    }

    .permission-buttons {
        width: 100%;
    }

    .permission-buttons .ascii-btn {
        width: 100%;
    }
}

/* ===========================================================================
   RETURN GREETING
   Welcome back overlay for returning readers
   =========================================================================== */

.return-greeting {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(5, 8, 15, 0.95);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10000;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.5s ease;
}

.return-greeting.visible {
    opacity: 1;
    pointer-events: auto;
}

.greeting-content {
    text-align: center;
    max-width: 600px;
    padding: var(--space-xl);
    position: relative;
    animation: greetingPulse 4s ease infinite;
}

@keyframes greetingPulse {
    0%, 100% {
        opacity: 1;
    }
    50% {
        opacity: 0.9;
    }
}

.greeting-main {
    font-family: 'Spectral', Georgia, serif;
    font-size: clamp(1.3rem, 3vw, 1.8rem);
    color: var(--starlight);
    line-height: 1.6;
    margin-bottom: var(--space-lg);
    text-shadow: 0 0 30px rgba(200, 220, 255, 0.3);
}

.greeting-insight {
    font-family: 'Spectral', Georgia, serif;
    font-size: clamp(1rem, 2vw, 1.2rem);
    color: var(--text-tertiary);
    line-height: 1.5;
    font-style: italic;
}

.greeting-dismiss {
    position: absolute;
    top: -10px;
    right: -10px;
    width: 40px;
    height: 40px;
    background: transparent;
    border: 1px solid rgba(150, 180, 220, 0.3);
    border-radius: 50%;
    color: var(--text-tertiary);
    font-size: 1.5rem;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    line-height: 1;
}

.greeting-dismiss:hover {
    background: rgba(150, 180, 220, 0.1);
    border-color: var(--starlight);
    color: var(--starlight);
}

/* Greeting responsive */
@media (max-width: 768px) {
    .greeting-content {
        padding: var(--space-lg);
    }

    .greeting-dismiss {
        top: -20px;
        right: 0;
    }
}

/* ==========================================
   ENHANCED SUPERNOVA & BLACK HOLE
   ========================================== */

/* Supernova container */
.supernova-container {
    position: absolute;
    pointer-events: none;
    z-index: 100;
    transform: translate(-50%, -50%);
}

/* Supernova core - central explosion */
.supernova-core {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: radial-gradient(
        ellipse 55% 45% at 45% 45%,
        var(--supernova-core-hot) 0%,
        var(--supernova-core-warm) 30%,
        var(--supernova-shockwave) 60%,
        transparent 100%
    );
    box-shadow:
        0 0 20px var(--supernova-core-warm),
        0 0 40px var(--supernova-shockwave),
        0 0 60px rgba(255, 140, 0, 0.4);
    transition: transform 0.3s ease-out, opacity 0.5s ease;
}

/* Supernova shockwave ring */
.supernova-shockwave {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 30px;
    height: 30px;
    border-radius: 50%;
    border: 2px solid var(--supernova-shockwave);
    box-shadow:
        0 0 10px var(--supernova-shockwave),
        0 0 20px rgba(255, 102, 0, 0.5),
        inset 0 0 10px rgba(255, 140, 0, 0.3);
    opacity: 0;
    transition: width 1s ease-out, height 1s ease-out, opacity 0.5s ease;
}

.supernova-shockwave.expanding {
    opacity: 1;
}

/* Supernova flash overlay */
.supernova-flash {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(
        ellipse at var(--flash-x, 50%) var(--flash-y, 50%),
        rgba(255, 255, 255, 0.8) 0%,
        rgba(255, 248, 224, 0.4) 20%,
        transparent 60%
    );
    pointer-events: none;
    z-index: 9999;
    opacity: 0;
    transition: opacity 0.1s ease-out;
}

.supernova-flash.active {
    opacity: 1;
    animation: flashFade 0.8s ease-out forwards;
}

@keyframes flashFade {
    0% { opacity: 1; }
    100% { opacity: 0; }
}

/* Supernova ejecta particles */
.supernova-ejecta {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 4px;
    height: 60px;
    background: linear-gradient(
        to top,
        transparent 0%,
        var(--supernova-ejecta) 30%,
        var(--supernova-core-warm) 70%,
        var(--supernova-core-hot) 100%
    );
    border-radius: 2px;
    transform-origin: bottom center;
    opacity: 0;
    filter: blur(1px);
    box-shadow: 0 0 8px var(--supernova-ejecta);
}

.supernova-ejecta.visible {
    opacity: 1;
    animation: ejectaExpand 2s ease-out forwards;
}

@keyframes ejectaExpand {
    0% {
        height: 20px;
        opacity: 1;
    }
    70% {
        opacity: 0.8;
    }
    100% {
        height: 120px;
        opacity: 0;
    }
}

/* Inner glow - soft halo around core */
.supernova-inner-glow {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: radial-gradient(
        circle,
        rgba(255, 255, 255, 0.6) 0%,
        rgba(255, 248, 200, 0.4) 30%,
        rgba(255, 200, 100, 0.2) 60%,
        transparent 100%
    );
    filter: blur(8px);
    opacity: 0;
    transition: all 0.3s ease;
}

/* Nebula clouds - irregular expanding gas clouds */
.supernova-nebula {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.1);
    border-radius: 45% 55% 50% 60% / 50% 45% 55% 50%;
    filter: blur(12px);
    mix-blend-mode: screen;
    opacity: 0;
    will-change: transform, opacity;
}

.supernova-nebula.nebula-1 {
    width: 100px;
    height: 90px;
    background: radial-gradient(
        ellipse 60% 50% at 40% 45%,
        rgba(255, 200, 100, 0.7) 0%,
        rgba(255, 140, 60, 0.4) 40%,
        rgba(255, 100, 50, 0.2) 70%,
        transparent 100%
    );
    animation: nebulaExpand1 4s ease-out forwards;
}

.supernova-nebula.nebula-2 {
    width: 120px;
    height: 100px;
    background: radial-gradient(
        ellipse 55% 60% at 55% 50%,
        rgba(255, 180, 150, 0.6) 0%,
        rgba(255, 120, 80, 0.3) 50%,
        transparent 100%
    );
    animation: nebulaExpand2 5s ease-out 0.3s forwards;
}

.supernova-nebula.nebula-3 {
    width: 80px;
    height: 110px;
    background: radial-gradient(
        ellipse 50% 55% at 50% 55%,
        rgba(200, 150, 255, 0.5) 0%,
        rgba(150, 100, 200, 0.3) 40%,
        transparent 100%
    );
    animation: nebulaExpand3 4.5s ease-out 0.5s forwards;
}

.supernova-nebula.nebula-4 {
    width: 90px;
    height: 85px;
    background: radial-gradient(
        ellipse 65% 45% at 45% 40%,
        rgba(100, 150, 200, 0.4) 0%,
        rgba(80, 120, 180, 0.2) 60%,
        transparent 100%
    );
    animation: nebulaExpand4 5.5s ease-out 0.7s forwards;
}

@keyframes nebulaExpand1 {
    0% {
        transform: translate(-50%, -50%) scale(0.1) rotate(0deg);
        opacity: 0;
    }
    15% {
        opacity: 0.9;
    }
    50% {
        opacity: 0.7;
    }
    100% {
        transform: translate(-40%, -45%) scale(3.5) rotate(25deg);
        opacity: 0;
    }
}

@keyframes nebulaExpand2 {
    0% {
        transform: translate(-50%, -50%) scale(0.1) rotate(0deg);
        opacity: 0;
    }
    15% {
        opacity: 0.8;
    }
    100% {
        transform: translate(-60%, -55%) scale(4) rotate(-20deg);
        opacity: 0;
    }
}

@keyframes nebulaExpand3 {
    0% {
        transform: translate(-50%, -50%) scale(0.1) rotate(0deg);
        opacity: 0;
    }
    20% {
        opacity: 0.7;
    }
    100% {
        transform: translate(-45%, -60%) scale(3.2) rotate(40deg);
        opacity: 0;
    }
}

@keyframes nebulaExpand4 {
    0% {
        transform: translate(-50%, -50%) scale(0.1) rotate(0deg);
        opacity: 0;
    }
    20% {
        opacity: 0.6;
    }
    100% {
        transform: translate(-55%, -40%) scale(3.8) rotate(-35deg);
        opacity: 0;
    }
}

/* Lens flares - elongated light rays from center */
.supernova-flare {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 3px;
    background: linear-gradient(
        to top,
        transparent 0%,
        rgba(255, 255, 255, 0.3) 10%,
        rgba(255, 255, 255, 0.9) 50%,
        rgba(255, 255, 255, 0.3) 90%,
        transparent 100%
    );
    transform-origin: bottom center;
    filter: blur(1px);
    opacity: 0;
}

.supernova-flare.visible {
    animation: flareAppear 3s ease-out forwards;
}

@keyframes flareAppear {
    0% {
        opacity: 0;
        height: 10px;
    }
    20% {
        opacity: 0.9;
        height: var(--flare-length);
    }
    80% {
        opacity: 0.6;
    }
    100% {
        opacity: 0;
        height: var(--flare-length);
    }
}

/* Secondary shockwave - faster, dimmer */
.supernova-shockwave-secondary {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 20px;
    height: 20px;
    border-radius: 50%;
    border: 1px solid rgba(255, 200, 150, 0.6);
    box-shadow:
        0 0 6px rgba(255, 180, 120, 0.5),
        inset 0 0 4px rgba(255, 200, 150, 0.2);
    opacity: 0;
}

.supernova-shockwave-secondary.expanding {
    animation: shockwaveSecondary 2s ease-out forwards;
}

@keyframes shockwaveSecondary {
    0% {
        width: 30px;
        height: 30px;
        opacity: 0;
    }
    10% {
        opacity: 0.8;
    }
    100% {
        width: 350px;
        height: 350px;
        opacity: 0;
    }
}

/* Tertiary shockwave - fastest, thinnest */
.supernova-shockwave-tertiary {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    border-radius: 50%;
    border: 1px solid rgba(200, 180, 255, 0.4);
    box-shadow: 0 0 3px rgba(180, 150, 220, 0.3);
    opacity: 0;
}

.supernova-shockwave-tertiary.expanding {
    animation: shockwaveTertiary 1.5s ease-out forwards;
}

@keyframes shockwaveTertiary {
    0% {
        width: 40px;
        height: 40px;
        opacity: 0;
    }
    5% {
        opacity: 0.6;
    }
    100% {
        width: 400px;
        height: 400px;
        opacity: 0;
    }
}

/* Supernova particles - small dots that fly outward */
.supernova-particle {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 3px;
    height: 3px;
    border-radius: 50%;
    background: white;
    box-shadow: 0 0 4px white, 0 0 8px rgba(255, 200, 100, 0.8);
    opacity: 0;
    will-change: transform, opacity;
}

.supernova-particle.launched {
    animation: particleFly var(--particle-duration) ease-out forwards;
}

@keyframes particleFly {
    0% {
        transform: translate(-50%, -50%);
        opacity: 1;
    }
    30% {
        opacity: 0.9;
    }
    100% {
        transform: translate(
            calc(-50% + var(--particle-dx)),
            calc(-50% + var(--particle-dy))
        );
        opacity: 0;
    }
}

/* Core color transition animation */
.supernova-core.color-shifting {
    animation: coreColorShift 8s ease-out forwards;
}

@keyframes coreColorShift {
    0% {
        background: radial-gradient(
            ellipse 55% 45% at 45% 45%,
            #ffffff 0%,
            #fff8e0 30%,
            #ffd700 60%,
            rgba(255, 140, 0, 0.6) 100%
        );
        box-shadow:
            0 0 30px rgba(255, 255, 255, 0.8),
            0 0 60px rgba(255, 248, 200, 0.5),
            0 0 100px rgba(255, 200, 100, 0.3);
    }
    25% {
        background: radial-gradient(
            ellipse 55% 45% at 45% 45%,
            #fff8e0 0%,
            #ffd700 30%,
            #ff8c00 60%,
            rgba(255, 100, 0, 0.4) 100%
        );
    }
    50% {
        background: radial-gradient(
            ellipse 55% 45% at 45% 45%,
            #ffcc66 0%,
            #ff8c00 30%,
            #ff4500 60%,
            rgba(200, 50, 50, 0.3) 100%
        );
    }
    75% {
        background: radial-gradient(
            ellipse 55% 45% at 45% 45%,
            #ff6633 0%,
            #cc3300 30%,
            #993366 60%,
            rgba(100, 80, 150, 0.3) 100%
        );
    }
    100% {
        background: radial-gradient(
            ellipse 55% 45% at 45% 45%,
            #7799bb 0%,
            #5577aa 30%,
            #445588 60%,
            rgba(60, 70, 100, 0.2) 100%
        );
        box-shadow:
            0 0 20px rgba(120, 150, 200, 0.4),
            0 0 40px rgba(80, 100, 150, 0.2);
    }
}

/* Brightness ripple during peak emission */
.supernova-core.pulsing {
    animation: brightnessPulse 0.6s ease-in-out 3;
}

@keyframes brightnessPulse {
    0%, 100% {
        filter: brightness(1);
    }
    50% {
        filter: brightness(1.5);
    }
}

/* ==========================================
   BLACK HOLE
   ========================================== */

/* Black hole container */
.blackhole-container {
    position: absolute;
    pointer-events: none;
    z-index: 100;
    transform: translate(-50%, -50%);
    will-change: transform, opacity;
    contain: layout paint;
}

/* Event horizon - pure black sphere */
.blackhole-horizon {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: var(--blackhole-void);
    box-shadow:
        0 0 30px 10px var(--blackhole-horizon-glow),
        inset 0 0 20px rgba(0, 0, 0, 1);
    z-index: 10;
}

/* Photon ring - thin bright edge glow */
.blackhole-photon-ring {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 86px;
    height: 86px;
    border-radius: 50%;
    border: 1px solid var(--blackhole-photon-ring);
    box-shadow:
        0 0 8px 2px var(--blackhole-photon-ring),
        0 0 15px 4px rgba(255, 200, 150, 0.4),
        inset 0 0 8px rgba(255, 200, 150, 0.2);
    z-index: 9;
    opacity: 0;
    transition: opacity 1s ease;
}

.blackhole-photon-ring.visible {
    opacity: 1;
}

/* Accretion disk - horizontal ellipse with Doppler gradient */
.blackhole-disk {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 200px;
    height: 20px;
    background: linear-gradient(90deg,
        rgba(255, 100, 50, 0.25) 0%,
        rgba(255, 180, 100, 0.7) 35%,
        var(--blackhole-disk-hot) 50%,
        var(--blackhole-disk-warm) 60%,
        rgba(255, 100, 50, 0.2) 100%
    );
    border-radius: 50%;
    transform: translate(-50%, -50%) rotateX(75deg);
    box-shadow:
        0 0 20px 5px rgba(255, 180, 100, 0.3),
        0 0 40px 10px rgba(255, 140, 60, 0.15);
    z-index: 5;
    opacity: 0;
    transition: opacity 2s ease;
}

.blackhole-disk.visible {
    opacity: 1;
}

.blackhole-disk.rotating {
    animation: accretionRotate 8s linear infinite;
}

@keyframes accretionRotate {
    0% {
        transform: translate(-50%, -50%) rotateX(75deg) rotateZ(0deg);
    }
    100% {
        transform: translate(-50%, -50%) rotateX(75deg) rotateZ(360deg);
    }
}

/* Gravitational lensing rings - the distinctive Interstellar "halo" */
.blackhole-lensed-ring {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 180px;
    height: 100px;
    border: 3px solid transparent;
    border-radius: 50%;
    z-index: 4;
    opacity: 0;
    transition: opacity 1.5s ease;
}

.blackhole-lensed-ring.visible {
    opacity: 1;
}

/* Top lensed ring - light bent over the black hole */
.blackhole-lensed-top {
    transform: translate(-50%, -75%) rotateX(60deg);
    border-bottom-color: var(--blackhole-lensing);
    box-shadow: 0 3px 15px rgba(255, 180, 120, 0.4);
}

/* Bottom lensed ring - light bent under the black hole */
.blackhole-lensed-bottom {
    transform: translate(-50%, 25%) rotateX(-60deg);
    border-top-color: rgba(255, 180, 120, 0.6);
    box-shadow: 0 -3px 12px rgba(255, 180, 120, 0.3);
}

/* Stars affected by gravity */
.ascii-star.gravitating {
    transition: transform 0.1s linear, opacity 0.3s ease;
}

.ascii-star.consumed {
    opacity: 0 !important;
    transform: scale(0.1) !important;
}

/* Text warping near black hole */
.gravity-warped {
    transition: letter-spacing 0.5s ease, filter 0.5s ease;
}

/* Black hole audio visualizer hint (subtle glow pulse) */
.blackhole-container.audio-active .blackhole-horizon {
    animation: horizonPulse 4s ease-in-out infinite;
}

@keyframes horizonPulse {
    0%, 100% {
        box-shadow:
            0 0 30px 10px var(--blackhole-horizon-glow),
            inset 0 0 20px rgba(0, 0, 0, 1);
    }
    50% {
        box-shadow:
            0 0 40px 15px var(--blackhole-horizon-glow),
            0 0 60px 20px rgba(80, 60, 40, 0.15),
            inset 0 0 20px rgba(0, 0, 0, 1);
    }
}

/* Supernova to black hole collapse animation */
.supernova-core.collapsing {
    animation: coreCollapse 2s ease-in forwards;
}

@keyframes coreCollapse {
    0% {
        transform: translate(-50%, -50%) scale(20);
        background: radial-gradient(
            ellipse at center,
            var(--supernova-remnant) 0%,
            rgba(90, 122, 159, 0.5) 50%,
            transparent 100%
        );
        opacity: 1;
    }
    50% {
        transform: translate(-50%, -50%) scale(5);
        opacity: 0.8;
    }
    100% {
        transform: translate(-50%, -50%) scale(0);
        opacity: 0;
    }
}

/* Mobile adjustments for cosmic events */
@media (max-width: 768px) {
    .blackhole-horizon {
        width: 60px;
        height: 60px;
    }

    .blackhole-photon-ring {
        width: 66px;
        height: 66px;
    }

    .blackhole-disk {
        width: 150px;
        height: 15px;
    }

    .blackhole-lensed-ring {
        width: 140px;
        height: 80px;
    }

    .supernova-ejecta {
        height: 40px;
    }

    @keyframes ejectaExpand {
        0% { height: 15px; opacity: 1; }
        100% { height: 80px; opacity: 0; }
    }
}

@media (max-width: 480px) {
    .blackhole-horizon {
        width: 50px;
        height: 50px;
    }

    .blackhole-photon-ring {
        width: 56px;
        height: 56px;
    }

    .blackhole-disk {
        width: 120px;
        height: 12px;
    }

    .blackhole-lensed-ring {
        width: 110px;
        height: 60px;
        border-width: 2px;
    }
}

/* ==========================================
   ARTISTIC SUPERNOVA - Enhanced Visual Effects
   ========================================== */

/* Pre-ignition: Arrhythmic heartbeat via overlaid animations */
.supernova-progenitor {
    position: absolute;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: radial-gradient(
        circle at 45% 45%,
        #fff 0%,
        var(--supernova-core-hot) 30%,
        var(--supernova-core-warm) 60%,
        transparent 100%
    );
    box-shadow:
        0 0 15px var(--supernova-core-warm),
        0 0 30px rgba(255, 200, 100, 0.3);
    transform: translate(-50%, -50%);
    pointer-events: none;
}

.supernova-progenitor.unstable {
    animation:
        heartbeat-primary 0.7s ease-in-out infinite,
        heartbeat-secondary 1.1s ease-in-out infinite,
        color-instability 0.3s step-end infinite;
}

@keyframes heartbeat-primary {
    0%, 100% { transform: translate(-50%, -50%) scale(1); }
    40% { transform: translate(-50%, -50%) scale(0.85); }
    60% { transform: translate(-50%, -50%) scale(1.15); }
}

@keyframes heartbeat-secondary {
    0%, 100% {
        box-shadow:
            0 0 15px var(--supernova-core-warm),
            0 0 30px rgba(255, 200, 100, 0.3);
    }
    35% {
        box-shadow:
            0 0 25px var(--supernova-core-hot),
            0 0 50px rgba(255, 220, 150, 0.5);
    }
    70% {
        box-shadow:
            0 0 8px var(--supernova-core-warm),
            0 0 15px rgba(255, 180, 80, 0.2);
    }
}

@keyframes color-instability {
    0% { filter: hue-rotate(0deg) brightness(1); }
    33% { filter: hue-rotate(-15deg) brightness(1.2); }
    66% { filter: hue-rotate(10deg) brightness(0.9); }
    100% { filter: hue-rotate(0deg) brightness(1); }
}

/* Core collapse: Inward-rushing rings */
.collapse-ring {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    border-radius: 50%;
    border: 1px solid rgba(200, 220, 255, 0.6);
    pointer-events: none;
    animation: collapse-inward 0.6s ease-in forwards;
}

@keyframes collapse-inward {
    0% {
        width: 200px;
        height: 200px;
        opacity: 0.8;
        border-color: rgba(200, 220, 255, 0.6);
    }
    100% {
        width: 8px;
        height: 8px;
        opacity: 0;
        border-color: rgba(255, 255, 255, 0.9);
    }
}

/* Diffraction spikes - iconic 4-point or 6-point star */
.diffraction-spike {
    position: absolute;
    top: 50%;
    left: 50%;
    height: 2px;
    background: linear-gradient(90deg,
        transparent 0%,
        rgba(255, 255, 255, 0.05) 15%,
        rgba(255, 255, 255, 0.4) 35%,
        rgba(255, 255, 255, 1) 50%,
        rgba(255, 255, 255, 0.4) 65%,
        rgba(255, 255, 255, 0.05) 85%,
        transparent 100%
    );
    transform-origin: center center;
    filter: blur(0.5px);
    pointer-events: none;
    opacity: 0;
}

.diffraction-spike.visible {
    animation: diffraction-flash 2s ease-out forwards;
}

@keyframes diffraction-flash {
    0% {
        width: 50px;
        opacity: 0;
    }
    10% {
        opacity: 1;
        width: 350px;
    }
    30% {
        opacity: 0.8;
    }
    100% {
        width: 400px;
        opacity: 0;
    }
}

/* Secondary diffraction spikes - dimmer, angled differently */
.diffraction-spike.secondary {
    height: 1px;
    filter: blur(1px);
}

.diffraction-spike.secondary.visible {
    animation: diffraction-flash-secondary 2s ease-out forwards;
}

@keyframes diffraction-flash-secondary {
    0% { width: 30px; opacity: 0; }
    10% { opacity: 0.6; width: 200px; }
    100% { width: 250px; opacity: 0; }
}

/* Chromatic ring - rainbow dispersion at flash edge */
.chromatic-ring {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    border-radius: 50%;
    background: conic-gradient(from 0deg,
        rgba(255, 120, 120, 0.25),
        rgba(255, 200, 120, 0.25),
        rgba(200, 255, 120, 0.25),
        rgba(120, 255, 200, 0.25),
        rgba(120, 200, 255, 0.25),
        rgba(200, 120, 255, 0.25),
        rgba(255, 120, 200, 0.25),
        rgba(255, 120, 120, 0.25)
    );
    filter: blur(12px);
    mix-blend-mode: screen;
    pointer-events: none;
    opacity: 0;
}

.chromatic-ring.visible {
    animation: chromatic-expand 2.5s ease-out forwards;
}

@keyframes chromatic-expand {
    0% {
        width: 30px;
        height: 30px;
        opacity: 0;
    }
    10% {
        opacity: 0.9;
    }
    50% {
        opacity: 0.5;
    }
    100% {
        width: 400px;
        height: 400px;
        opacity: 0;
    }
}

/* Organic shockwave - wobbly, not perfectly circular */
.organic-shockwave {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    border: 2px solid var(--supernova-shockwave);
    border-radius: 47% 53% 51% 49% / 52% 48% 52% 48%;
    box-shadow:
        0 0 15px var(--supernova-shockwave),
        0 0 30px rgba(255, 140, 0, 0.3),
        inset 0 0 10px rgba(255, 180, 100, 0.2);
    pointer-events: none;
    opacity: 0;
}

.organic-shockwave.expanding {
    animation:
        organic-expand 4s ease-out forwards,
        shockwave-wobble 0.5s ease-in-out infinite;
}

@keyframes organic-expand {
    0% {
        width: 20px;
        height: 20px;
        opacity: 0;
        border-width: 3px;
    }
    5% {
        opacity: 1;
    }
    50% {
        opacity: 0.6;
        border-width: 2px;
    }
    100% {
        width: 500px;
        height: 500px;
        opacity: 0;
        border-width: 1px;
    }
}

@keyframes shockwave-wobble {
    0%, 100% { border-radius: 47% 53% 51% 49% / 52% 48% 52% 48%; }
    25% { border-radius: 51% 49% 48% 52% / 49% 51% 50% 50%; }
    50% { border-radius: 48% 52% 53% 47% / 51% 49% 48% 52%; }
    75% { border-radius: 52% 48% 49% 51% / 48% 52% 51% 49%; }
}

/* Light echoes - concentric rings appearing AFTER the main event */
.light-echo {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    border-radius: 50%;
    border: 1px solid transparent;
    background: radial-gradient(
        circle,
        transparent 92%,
        rgba(160, 180, 220, 0.15) 95%,
        rgba(180, 200, 240, 0.35) 97%,
        rgba(160, 180, 220, 0.15) 99%,
        transparent 100%
    );
    pointer-events: none;
    opacity: 0;
}

.light-echo.visible {
    animation: echo-expand var(--echo-duration, 5s) ease-out forwards;
}

@keyframes echo-expand {
    0% {
        width: 60px;
        height: 60px;
        opacity: 0;
    }
    8% {
        opacity: 0.7;
    }
    40% {
        opacity: 0.4;
    }
    100% {
        width: var(--echo-size, 350px);
        height: var(--echo-size, 350px);
        opacity: 0;
    }
}

/* Multiple echo rings with different sizes */
.light-echo.echo-1 { --echo-size: 300px; --echo-duration: 4s; }
.light-echo.echo-2 { --echo-size: 450px; --echo-duration: 5s; }
.light-echo.echo-3 { --echo-size: 600px; --echo-duration: 6s; }

/* Star brightening effect when shockwave passes */
.ascii-star.shockwave-brightened {
    transition: filter 0.15s ease-out, text-shadow 0.15s ease-out;
}

.ascii-star.shockwave-active {
    filter: brightness(2.5) !important;
    text-shadow: 0 0 12px currentColor !important;
}

/* Filamentary structure - thin bright threads in remnant */
.supernova-filament {
    position: absolute;
    top: 50%;
    left: 50%;
    transform-origin: center center;
    height: 1px;
    background: linear-gradient(90deg,
        transparent 0%,
        rgba(255, 200, 150, 0.1) 20%,
        rgba(255, 200, 150, 0.3) 50%,
        rgba(255, 200, 150, 0.1) 80%,
        transparent 100%
    );
    pointer-events: none;
    opacity: 0;
}

.supernova-filament.visible {
    animation: filament-appear 3s ease-out forwards;
}

@keyframes filament-appear {
    0% {
        width: 20px;
        opacity: 0;
    }
    20% {
        opacity: 0.6;
    }
    100% {
        width: var(--filament-length, 150px);
        opacity: 0;
    }
}

/* Asymmetric ejecta - clustered in directions */
.asymmetric-ejecta {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 4px;
    background: linear-gradient(
        to top,
        transparent 0%,
        var(--supernova-ejecta) 20%,
        var(--supernova-core-warm) 50%,
        var(--supernova-core-hot) 100%
    );
    border-radius: 2px 2px 50% 50%;
    transform-origin: bottom center;
    filter: blur(0.5px);
    pointer-events: none;
    opacity: 0;
}

.asymmetric-ejecta.launched {
    animation: ejecta-launch var(--ejecta-duration, 2.5s) ease-out forwards;
}

@keyframes ejecta-launch {
    0% {
        height: 10px;
        opacity: 0;
        transform: rotate(var(--ejecta-angle, 0deg)) translateY(0);
    }
    15% {
        opacity: var(--ejecta-brightness, 0.9);
        height: 30px;
        transform: rotate(var(--ejecta-angle, 0deg)) translateY(calc(-0.15 * var(--ejecta-travel, 80px)));
    }
    70% {
        opacity: calc(var(--ejecta-brightness, 0.9) * 0.5);
        transform: rotate(var(--ejecta-angle, 0deg)) translateY(calc(-0.7 * var(--ejecta-travel, 80px)));
    }
    100% {
        height: var(--ejecta-length, 120px);
        opacity: 0;
        transform: rotate(var(--ejecta-angle, 0deg)) translateY(calc(-1 * var(--ejecta-travel, 80px)));
    }
}

/* Black hole gasp - final flash before darkness */
.blackhole-gasp {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 100px;
    height: 100px;
    border-radius: 50%;
    background: radial-gradient(
        circle,
        rgba(255, 255, 255, 0.9) 0%,
        rgba(255, 200, 150, 0.6) 30%,
        rgba(100, 80, 60, 0.3) 60%,
        transparent 100%
    );
    pointer-events: none;
    opacity: 0;
}

.blackhole-gasp.active {
    animation: gasp-flash 0.8s ease-out forwards;
}

@keyframes gasp-flash {
    0% {
        width: 20px;
        height: 20px;
        opacity: 0;
    }
    20% {
        opacity: 1;
        width: 80px;
        height: 80px;
    }
    100% {
        width: 5px;
        height: 5px;
        opacity: 0;
    }
}

/* Neutron star remnant - blue pulsing core */
.neutron-star {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 8px;
    height: 8px;
    background: radial-gradient(circle, #aaccff 0%, #6699ff 50%, #3366cc 100%);
    border-radius: 50%;
    opacity: 0;
    z-index: 25;
    box-shadow:
        0 0 10px 2px rgba(100, 150, 255, 0.8),
        0 0 20px 4px rgba(100, 150, 255, 0.5),
        0 0 40px 8px rgba(100, 150, 255, 0.3);
    pointer-events: none;
}

.neutron-star.visible {
    animation: neutron-appear 3s ease-out forwards;
}

.neutron-star.pulsing {
    animation: neutron-pulse 0.05s ease-in-out infinite;
}

@keyframes neutron-appear {
    0% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0);
    }
    60% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1.5);
    }
    100% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
    }
}

@keyframes neutron-pulse {
    0%, 100% {
        filter: brightness(1);
        box-shadow:
            0 0 10px 2px rgba(100, 150, 255, 0.8),
            0 0 20px 4px rgba(100, 150, 255, 0.5),
            0 0 40px 8px rgba(100, 150, 255, 0.3);
    }
    50% {
        filter: brightness(1.5);
        box-shadow:
            0 0 15px 3px rgba(150, 180, 255, 1),
            0 0 30px 6px rgba(100, 150, 255, 0.7),
            0 0 60px 12px rgba(100, 150, 255, 0.4);
    }
}

/* Pulsar beams - spinning jets from neutron star */
.pulsar-beam {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 2px;
    height: 150px;
    background: linear-gradient(to top,
        rgba(150, 180, 255, 0.9) 0%,
        rgba(100, 150, 255, 0.5) 30%,
        rgba(100, 150, 255, 0.2) 60%,
        transparent 100%
    );
    transform-origin: bottom center;
    transform: translateX(-50%);
    opacity: 0;
    z-index: 24;
    pointer-events: none;
    filter: blur(1px);
}

.pulsar-beam.visible {
    animation: pulsar-appear 2s ease-out forwards;
}

.pulsar-beam.spinning {
    animation: pulsar-spin 2s linear infinite;
}

.pulsar-beam.opposite {
    transform: translateX(-50%) rotate(180deg);
}

.pulsar-beam.opposite.spinning {
    animation: pulsar-spin-opposite 2s linear infinite;
}

@keyframes pulsar-appear {
    0% { opacity: 0; height: 20px; }
    100% { opacity: 0.7; height: 150px; }
}

@keyframes pulsar-spin {
    from { transform: translateX(-50%) rotate(0deg); }
    to { transform: translateX(-50%) rotate(360deg); }
}

@keyframes pulsar-spin-opposite {
    from { transform: translateX(-50%) rotate(180deg); }
    to { transform: translateX(-50%) rotate(540deg); }
}

/* Nebula clouds - scientific colors */
.nebula-cloud {
    position: absolute;
    top: 50%;
    left: 50%;
    border-radius: 50%;
    filter: blur(20px);
    mix-blend-mode: screen;
    opacity: 0;
    pointer-events: none;
    will-change: transform, opacity;
}

.nebula-cloud.visible {
    animation: nebula-drift var(--nebula-duration, 15s) ease-out forwards;
}

/* Hydrogen alpha - deep rose/pink */
.nebula-cloud.hydrogen {
    background: radial-gradient(
        ellipse 60% 50% at 50% 50%,
        rgba(255, 100, 120, 0.4) 0%,
        rgba(255, 80, 100, 0.2) 40%,
        transparent 70%
    );
}

/* Oxygen III - teal/cyan */
.nebula-cloud.oxygen {
    background: radial-gradient(
        ellipse 55% 60% at 50% 50%,
        rgba(80, 220, 200, 0.35) 0%,
        rgba(60, 180, 170, 0.15) 50%,
        transparent 70%
    );
}

/* Sulfur II - deep red/crimson */
.nebula-cloud.sulfur {
    background: radial-gradient(
        ellipse 50% 55% at 50% 50%,
        rgba(200, 60, 80, 0.35) 0%,
        rgba(160, 40, 60, 0.15) 45%,
        transparent 70%
    );
}

/* Nitrogen - blue/indigo */
.nebula-cloud.nitrogen {
    background: radial-gradient(
        ellipse 55% 50% at 50% 50%,
        rgba(100, 140, 255, 0.3) 0%,
        rgba(80, 100, 200, 0.15) 50%,
        transparent 70%
    );
}

@keyframes nebula-drift {
    0% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.3) rotate(0deg);
    }
    20% {
        opacity: var(--nebula-opacity, 0.6);
    }
    100% {
        opacity: var(--nebula-opacity, 0.6);
        transform: translate(
            calc(-50% + var(--nebula-drift-x, 0px)),
            calc(-50% + var(--nebula-drift-y, 0px))
        ) scale(var(--nebula-scale, 1)) rotate(var(--nebula-rotate, 15deg));
    }
}

/* Detonation flash with multi-pulse */
.detonation-flash {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(
        ellipse at var(--flash-x, 50%) var(--flash-y, 50%),
        rgba(255, 255, 255, 0.95) 0%,
        rgba(255, 250, 240, 0.7) 10%,
        rgba(255, 240, 220, 0.4) 25%,
        rgba(255, 220, 180, 0.15) 45%,
        transparent 70%
    );
    pointer-events: none;
    z-index: 9999;
    opacity: 0;
}

.detonation-flash.active {
    animation: detonation-pulse 0.15s steps(4) forwards;
}

@keyframes detonation-pulse {
    0% { opacity: 0; }
    25% { opacity: 1; }
    50% { opacity: 0.6; }
    75% { opacity: 1; }
    100% { opacity: 0; }
}

/* ==========================================
   V3 SUPERNOVA - LIGHT RAYS
   Conic gradient with subtle ray segments
   ========================================== */
.light-rays {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 200vmax;
    height: 200vmax;
    opacity: 0;
    pointer-events: none;
    z-index: 17;
}

.light-rays::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: conic-gradient(
        from 0deg,
        transparent 0deg,
        rgba(255, 250, 230, 0.12) 1.5deg,
        transparent 3deg,
        transparent 12deg,
        rgba(255, 220, 180, 0.08) 13.5deg,
        transparent 15deg,
        transparent 24deg,
        rgba(255, 240, 200, 0.1) 25.5deg,
        transparent 27deg,
        transparent 36deg,
        rgba(255, 255, 255, 0.06) 37.5deg,
        transparent 39deg,
        transparent 48deg,
        rgba(255, 230, 190, 0.09) 49.5deg,
        transparent 51deg,
        transparent 60deg,
        rgba(255, 245, 220, 0.11) 61.5deg,
        transparent 63deg,
        transparent 72deg,
        rgba(255, 220, 170, 0.07) 73.5deg,
        transparent 75deg,
        transparent 84deg,
        rgba(255, 255, 240, 0.1) 85.5deg,
        transparent 87deg,
        transparent 96deg,
        rgba(255, 235, 200, 0.08) 97.5deg,
        transparent 99deg,
        transparent 108deg,
        rgba(255, 250, 230, 0.12) 109.5deg,
        transparent 111deg,
        transparent 120deg,
        rgba(255, 225, 180, 0.07) 121.5deg,
        transparent 123deg,
        transparent 132deg,
        rgba(255, 240, 210, 0.09) 133.5deg,
        transparent 135deg,
        transparent 144deg,
        rgba(255, 255, 235, 0.11) 145.5deg,
        transparent 147deg,
        transparent 156deg,
        rgba(255, 230, 190, 0.06) 157.5deg,
        transparent 159deg,
        transparent 168deg,
        rgba(255, 245, 215, 0.13) 169.5deg,
        transparent 171deg,
        transparent 180deg,
        rgba(255, 220, 175, 0.08) 181.5deg,
        transparent 183deg,
        transparent 192deg,
        rgba(255, 250, 225, 0.1) 193.5deg,
        transparent 195deg,
        transparent 204deg,
        rgba(255, 235, 195, 0.07) 205.5deg,
        transparent 207deg,
        transparent 216deg,
        rgba(255, 245, 220, 0.12) 217.5deg,
        transparent 219deg,
        transparent 228deg,
        rgba(255, 225, 185, 0.09) 229.5deg,
        transparent 231deg,
        transparent 240deg,
        rgba(255, 255, 240, 0.06) 241.5deg,
        transparent 243deg,
        transparent 252deg,
        rgba(255, 240, 200, 0.11) 253.5deg,
        transparent 255deg,
        transparent 264deg,
        rgba(255, 230, 180, 0.08) 265.5deg,
        transparent 267deg,
        transparent 276deg,
        rgba(255, 250, 230, 0.1) 277.5deg,
        transparent 279deg,
        transparent 288deg,
        rgba(255, 220, 170, 0.07) 289.5deg,
        transparent 291deg,
        transparent 300deg,
        rgba(255, 245, 210, 0.12) 301.5deg,
        transparent 303deg,
        transparent 312deg,
        rgba(255, 235, 190, 0.09) 313.5deg,
        transparent 315deg,
        transparent 324deg,
        rgba(255, 255, 235, 0.06) 325.5deg,
        transparent 327deg,
        transparent 336deg,
        rgba(255, 240, 195, 0.1) 337.5deg,
        transparent 339deg,
        transparent 348deg,
        rgba(255, 250, 220, 0.08) 349.5deg,
        transparent 351deg,
        transparent 360deg
    );
    animation: rays-rotate 60s linear infinite;
}

.light-rays.visible {
    animation: rays-appear 8s ease-out forwards;
}

@keyframes rays-appear {
    0% { opacity: 0; transform: translate(-50%, -50%) scale(0.1); }
    8% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
    40% { opacity: 0.5; }
    100% { opacity: 0; }
}

@keyframes rays-rotate {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

/* ==========================================
   V3 SUPERNOVA - LENS FLARES
   Multiple flares including hex and anamorphic
   ========================================== */
.lens-flare {
    position: absolute;
    border-radius: 50%;
    opacity: 0;
    z-index: 30;
    pointer-events: none;
}

.lens-flare.visible {
    animation: flare-appear 6s ease-out forwards;
}

/* Blue-white flare */
.lens-flare.flare-blue {
    width: 80px;
    height: 80px;
    background: radial-gradient(circle, rgba(180, 220, 255, 0.5) 0%, transparent 70%);
}

/* Warm orange flare */
.lens-flare.flare-warm {
    width: 40px;
    height: 40px;
    background: radial-gradient(circle, rgba(255, 200, 150, 0.6) 0%, transparent 70%);
}

/* Small cyan flare */
.lens-flare.flare-cyan {
    width: 20px;
    height: 20px;
    background: radial-gradient(circle, rgba(150, 200, 255, 0.7) 0%, transparent 70%);
}

/* Large pink flare */
.lens-flare.flare-pink {
    width: 100px;
    height: 100px;
    background: radial-gradient(circle, rgba(255, 150, 180, 0.3) 0%, transparent 70%);
}

/* Small green flare */
.lens-flare.flare-green {
    width: 25px;
    height: 25px;
    background: radial-gradient(circle, rgba(100, 255, 200, 0.5) 0%, transparent 70%);
}

/* Purple flare */
.lens-flare.flare-purple {
    width: 60px;
    height: 60px;
    background: radial-gradient(circle, rgba(200, 180, 255, 0.35) 0%, transparent 70%);
}

/* Hexagonal flare - real lens artifact */
.lens-flare.flare-hex {
    width: 50px;
    height: 50px;
    background: transparent;
    border: 1px solid rgba(180, 220, 255, 0.4);
    clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
}

/* Anamorphic streak - horizontal lens artifact */
.lens-flare.flare-anamorphic {
    width: 40%;
    height: 4px;
    border-radius: 0;
    background: linear-gradient(90deg,
        transparent 0%,
        rgba(150, 200, 255, 0.3) 20%,
        rgba(200, 220, 255, 0.6) 50%,
        rgba(150, 200, 255, 0.3) 80%,
        transparent 100%
    );
}

.lens-flare.flare-anamorphic.visible {
    animation: anamorphic-appear 5s ease-out forwards;
}

@keyframes flare-appear {
    0% { opacity: 0; }
    10% { opacity: 1; }
    30% { opacity: 0.7; }
    100% { opacity: 0; }
}

@keyframes anamorphic-appear {
    0% { opacity: 0; transform: scaleX(0.5); }
    10% { opacity: 1; transform: scaleX(1.2); }
    30% { opacity: 0.6; }
    100% { opacity: 0; transform: scaleX(0.8); }
}

/* ==========================================
   V3 SUPERNOVA - SCREEN FLASH
   Full screen white flash at detonation
   ========================================== */
.screen-flash {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #fff;
    opacity: 0;
    z-index: 9998;
    pointer-events: none;
}

.screen-flash.active {
    animation: screen-flash-pulse 2s ease-out forwards;
}

@keyframes screen-flash-pulse {
    0% { opacity: 0; }
    5% { opacity: 1; }
    15% { opacity: 0.7; }
    30% { opacity: 0.3; }
    60% { opacity: 0.05; }
    100% { opacity: 0; }
}

/* Flash overlay - radial gradient version */
.flash-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle at 50% 50%,
        rgba(255, 255, 255, 0.9) 0%,
        rgba(255, 240, 200, 0.5) 20%,
        transparent 60%
    );
    opacity: 0;
    z-index: 22;
    pointer-events: none;
}

.flash-overlay.visible {
    animation: flash-overlay-expand 4s ease-out forwards;
}

@keyframes flash-overlay-expand {
    0% { opacity: 0; transform: scale(0.5); }
    5% { opacity: 1; transform: scale(1); }
    20% { opacity: 0.6; }
    50% { opacity: 0.15; }
    100% { opacity: 0; }
}

/* ==========================================
   V3 SUPERNOVA - COLORED SHOCKWAVES
   4 colored rings with staggered timing + wobble
   ========================================== */
.shockwave-ring {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    border-radius: 47% 53% 51% 49% / 52% 48% 52% 48%;
    border: 2px solid rgba(180, 220, 255, 0.8);
    opacity: 0;
    z-index: 18;
    pointer-events: none;
}

/* Blue shockwave - first, fastest */
.shockwave-ring.shockwave-blue {
    border-color: rgba(180, 220, 255, 0.8);
    box-shadow: 0 0 10px rgba(180, 220, 255, 0.4);
}

/* Orange shockwave - second */
.shockwave-ring.shockwave-orange {
    border-color: rgba(255, 180, 140, 0.6);
    box-shadow: 0 0 10px rgba(255, 180, 140, 0.3);
}

/* Purple shockwave - third */
.shockwave-ring.shockwave-purple {
    border-color: rgba(180, 140, 220, 0.5);
    box-shadow: 0 0 10px rgba(180, 140, 220, 0.25);
}

/* Teal shockwave - fourth, slowest */
.shockwave-ring.shockwave-teal {
    border-color: rgba(140, 220, 200, 0.4);
    box-shadow: 0 0 10px rgba(140, 220, 200, 0.2);
}

.shockwave-ring.expanding {
    animation:
        shockwave-expand var(--shockwave-duration, 6s) ease-out forwards,
        shockwave-wobble 0.5s ease-in-out infinite;
}

@keyframes shockwave-expand {
    0% {
        width: 10px;
        height: 10px;
        opacity: 1;
        border-width: 3px;
    }
    100% {
        width: calc(120 * max(1vw, 1vh));
        height: calc(120 * max(1vw, 1vh));
        opacity: 0;
        border-width: 0.5px;
    }
}

/* ==========================================
   V3 SUPERNOVA - PROGENITOR GROWTH
   Dramatic growth then collapse
   ========================================== */
.supernova-progenitor.growing {
    animation:
        progenitor-grow 10s ease-in forwards,
        heartbeat-primary 0.7s ease-in-out infinite,
        color-instability 0.3s step-end infinite;
}

@keyframes progenitor-grow {
    0% { transform: translate(-50%, -50%) scale(1); }
    60% { transform: translate(-50%, -50%) scale(1.3); }
    80% { transform: translate(-50%, -50%) scale(2); }
    92% { transform: translate(-50%, -50%) scale(3.5); filter: brightness(3); }
    96% { transform: translate(-50%, -50%) scale(0.5); }
    100% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
}

/* Tension flicker - builds before explosion */
.tension-flicker {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 20px;
    height: 20px;
    background: transparent;
    border-radius: 50%;
    pointer-events: none;
    z-index: 19;
}

.tension-flicker.building {
    animation: tension-build 10s ease-in forwards;
}

@keyframes tension-build {
    0%, 50% { box-shadow: none; }
    70% { box-shadow: 0 0 30px 10px rgba(255, 255, 255, 0.3); }
    85% { box-shadow: 0 0 60px 20px rgba(255, 255, 255, 0.6); }
    92% { box-shadow: 0 0 120px 40px rgba(255, 255, 255, 0.9); }
    100% { box-shadow: none; }
}

/* ==========================================
   V3 SUPERNOVA - CORE EXPLOSION
   Main core flash with scaling
   ========================================== */
.supernova-core-v3 {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 10px;
    height: 10px;
    background: #fff;
    border-radius: 50%;
    opacity: 0;
    z-index: 25;
    pointer-events: none;
}

.supernova-core-v3.exploding {
    animation: core-explode 8s ease-out forwards;
}

@keyframes core-explode {
    0% {
        transform: translate(-50%, -50%) scale(0);
        opacity: 0;
        background: #fff;
    }
    3% {
        transform: translate(-50%, -50%) scale(20);
        opacity: 1;
        background: #fff;
        box-shadow:
            0 0 100px 50px rgba(255, 255, 255, 1),
            0 0 200px 100px rgba(255, 240, 200, 0.8),
            0 0 400px 200px rgba(255, 180, 100, 0.5);
    }
    10% {
        transform: translate(-50%, -50%) scale(10);
        opacity: 1;
        background: #fffef0;
    }
    30% {
        transform: translate(-50%, -50%) scale(4);
        background: #ffdd88;
    }
    60% {
        transform: translate(-50%, -50%) scale(1);
        opacity: 0;
    }
    100% {
        transform: translate(-50%, -50%) scale(0);
        opacity: 0;
    }
}

/* Reduced motion - skip all cosmic event animations */
@media (prefers-reduced-motion: reduce) {
    .supernova-container,
    .blackhole-container,
    .supernova-flash,
    .detonation-flash,
    .supernova-progenitor,
    .light-echo,
    .diffraction-spike,
    .chromatic-ring,
    .organic-shockwave,
    .light-rays,
    .lens-flare,
    .screen-flash,
    .flash-overlay,
    .shockwave-ring,
    .tension-flicker,
    .supernova-core-v3 {
        display: none !important;
    }
}

/* ==========================================
   TOUCH-FRIENDLY SLIDERS
   ========================================== */
@media (pointer: coarse) {
    /* Year slider in light cone */
    .year-slider::-webkit-slider-thumb {
        width: 28px;
        height: 28px;
    }

    .year-slider::-moz-range-thumb {
        width: 28px;
        height: 28px;
    }

    /* Payoff matrix sliders */
    .payoff-slider input[type="range"]::-webkit-slider-thumb {
        width: 28px;
        height: 28px;
    }

    .payoff-slider input[type="range"]::-moz-range-thumb {
        width: 28px;
        height: 28px;
    }

    /* Credence sliders */
    .credence-slider::-webkit-slider-thumb {
        width: 32px;
        height: 32px;
    }

    .credence-slider::-moz-range-thumb {
        width: 32px;
        height: 32px;
    }

    /* Add touch-action to prevent 300ms delay */
    input[type="range"] {
        touch-action: manipulation;
    }

    /* Increase track height for easier targeting */
    .year-slider,
    .payoff-slider input[type="range"],
    .credence-slider {
        height: 8px;
    }
}
